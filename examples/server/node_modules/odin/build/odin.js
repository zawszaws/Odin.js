if("function"!=typeof define)var define=require("amdefine")(module);if(define("base/class",[],function(){function t(){this._id=++e,this._class=this.constructor.name,this._events={}}var e=0,i=Array.prototype.shift,n=Object.defineProperty;return t.prototype.clone=function(){var t=new this.constructor;return t.copy(this),t},t.prototype.copy=function(){return this},t.prototype.on=function(t,e){var i=this._events[t]||(this._events[t]=[]);i.push(e)},t.prototype.off=function(t){var e=this._events[t];e&&(e.length=0)},t.prototype.trigger=function(t){var e,n,o=this._events[t];if(o&&o.length)for(i.apply(arguments),n=o.length;n--;)(e=o[n]).apply(this,arguments)},t.prototype.toString=function(){return this._class},t.props=function(t,e){for(var i in e)n(t,i,e[i])},t.extend=function(e,i){var n,o=i.prototype,r=e.prototype=Object.create(o);for(n in o)r[n]=o[n];r.constructor=e,t.types[r.constructor.name]=r.constructor},t.types={Class:t},t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("base/device",[],function(){function t(){this.userAgent=e,this.pixelRatio=1/(window.devicePixelRatio||1),this.browser=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i)[1],this.touch="ontouchstart"in window,this.mobile=/android|webos|iphone|ipad|ipod|blackberry/i.test(e),this.webgl="WebGLRenderingContext"in window,this.canvas="CanvasRenderingContext2D"in window,this.gamepads=!!navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.webkitGamepads,this.audioMpeg=!!i.canPlayType("audio/mpeg"),this.audioOgg=!!i.canPlayType("audio/ogg"),this.audioMp4=!!i.canPlayType("audio/mp4"),this.videoWebm=!!n.canPlayType("video/webm"),this.videoOgg=!!n.canPlayType("video/ogg"),this.videoMp4=!!n.canPlayType("video/mp4")}var e=navigator.userAgent.toLowerCase(),i=new Audio,n=document.createElement("video");return new t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("base/dom",[],function(){function t(){}var e,i=/\s*[\s,]\s*/;return t.prototype.addEvent=function(t,e,n,o){var r,s=e.split(i),a=o||t,h=function(t){t=t||window.event,n&&n.call(a,t)};for(r=s.length;r--;)e=s[r],t.attachEvent?t.attachEvent("on"+e,h):t.addEventListener(e,h,!1)},t.prototype.removeEvent=function(t,e,n,o){var r,s,a=e.split(i),h=o||t,u=function(t){t=t||window.event,n&&n.call(h,t)};for(r=0,s=a.length;s>r;r++)e=a[r],t.detachEvent?t.detachEvent("on"+e,u):t.removeEventListener(e,u,!1)},t.prototype.addMeta=function(t,e,i){var n=document.createElement("meta"),o=document.getElementsByTagName("head")[0];t&&(n.id=t),e&&(n.name=e),i&&(n.content=i),o.insertBefore(n,o.firstChild)},t.prototype.audioContext=function(){return window.audioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext}(),t.prototype.requestAnimationFrame=function(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,50/3)};return function(e){return t(e)}}(),t.prototype.ajax=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){1===i.readyState&&i.send(),4===i.readyState&&(404===i.status?console.warn("Dom.ajax: 404 - file not found"):e(i.responseText))},i.open("GET",t,!0)},t.prototype.getWebGLContext=function(){var t=["webgl","webkit-3d","moz-webgl","experimental-webgl","3d"],e={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0};return function(i,n){var o,r,s=0;n||(n={});for(o in e)n[o]===void 0&&(n[o]=e[o]);for(s=t.length;s--&&!(r=i.getContext(t[s],n)););return r||console.warn("Dom.getWebGLContext: could not get webgl context"),r}}(),t.prototype.createShader=e=function(t,e,i){var n;return"fragment"===e?n=t.createShader(t.FRAGMENT_SHADER):"vertex"===e?n=t.createShader(t.VERTEX_SHADER):console.warn("Dom.createShader: no shader with type "+e),t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.warn("Dom.createShader: problem compiling shader "+t.getShaderInfoLog(n)),t.deleteShader(n),void 0)},t.prototype.createProgram=function(t,i,n){var o,r=t.createProgram();return o=e(t,"vertex",i),t.attachShader(r,o),t.deleteShader(o),o=e(t,"fragment",n),t.attachShader(r,o),t.deleteShader(o),t.linkProgram(r),t.validateProgram(r),t.useProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?r:(console.warn("Dom.createProgram: problem compiling Program "+t.getProgramInfoLog(r)),t.deleteProgram(r),void 0)},new t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("base/objectpool",[],function(){function t(t){this.pooled=[],this.objects=[],this.object=t}return t.prototype.create=function(){var t=this.pooled,e=t.length?t.pop():new this.object;return this.objects.push(e),e},t.prototype.remove=function(t){var e=this.objects,i=this.pooled,n=e.indexOf(t);n>-1&&(i.push(t),e.splice(n,1))},t.prototype.release=function(){for(var t=arguments.length;t--;)this.remove(arguments[t])},t.prototype.clear=function(){var t,e=this.objects,i=this.pooled;for(t=e.length;t--;)i.push(e[t]);e.length=0},t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("base/time",[],function(){function t(){this.start=e,this.sinceStart=0,this.sceneStart=0,this.sinceSceneStart=0,this.time=0,this._scale=1,this.delta=n,this._fixedDelta=i,this.frameCount=0}var e=.001*Date.now(),i=1/60,n=1/60;return Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.fixedDelta=i*t}}),Object.defineProperty(t.prototype,"fixedDelta",{get:function(){return this._fixedDelta},set:function(t){i=t,this._fixedDelta=t}}),Object.defineProperty(t.prototype,"invDelta",{get:function(){return 1/this.delta}}),t.prototype.now=function(){var t="undefined"!=typeof window?window:{},i=t.performance!==void 0?t.performance:{};return i.now=i.now||i.mozNow||i.msNow||i.oNow||i.webkitNow||function(){return Date.now()-e},function(){return.001*i.now()}}(),t.prototype.stamp=function(){return.001*Date.now()},new t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("base/utils",[],function(){function t(){}var e=Object.prototype,i=e.toString,n=e.hasOwnProperty;return t.prototype.has=function(t,e){return n.call(t,e)},t.prototype.isFunction=function(t){return"function"==typeof t},t.prototype.isFinite=function(t){return this.isFinite(t)&&!this.isNaN(parseFloat(t))},t.prototype.isNaN=function(t){return this.isNumber(t)&&t!==+t},t.prototype.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===i.call(t)},t.prototype.isNull=function(t){return void 0===t},t.prototype.isUndefined=function(t){return null===t},t.prototype.isArray=function(t){return"[object Array]"===i.call(t)},t.prototype.isArrayLike=function(t){return"object"==typeof t&&"number"==typeof t.length},t.prototype.isObject=function(t){return t===Object(t)},t.prototype.isString=function(t){return"string"==typeof t},t.prototype.isNumber=function(t){return"[object Number]"===i.call(t)},t.prototype.isArguments=function(t){return"[object Arguments]"===i.call(t)},t.prototype.isDate=function(t){return"[object Date]"===i.call(t)},t.prototype.isRegExp=function(t){return"[object RegExp]"===i.call(t)},t.prototype.isFloat32Array=function(t){return"[object Float32Array]"===i.call(t)},t.prototype.isFloat64Array=function(t){return"[object Float64Array]"===i.call(t)},t.prototype.isInt32Array=function(t){return"[object Int32Array]"===i.call(t)},t.prototype.isInt16Array=function(t){return"[object Int16Array]"===i.call(t)},t.prototype.isInt8Array=function(t){return"[object Int8Array]"===i.call(t)},t.prototype.isUint32Array=function(t){return"[object Uint32Array]"===i.call(t)},t.prototype.isUint16Array=function(t){return"[object Uint16Array]"===i.call(t)},t.prototype.isUint8Array=function(t){return"[object Uint8Array]"===i.call(t)},new t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/mathf",[],function(){function t(){this.PI=c,this.TWO_PI=p,this.HALF_PI=f,this.EPSILON=u,this.TO_RADS=d,this.TO_DEGS=l}var e,i,n,o,r,s=Math.random,a=Math.floor,h=Math.abs,u=(Math.atan2,1e-6),c=3.141592653589793,p=2*c,f=.5*c,d=c/180,l=180/c;return t.prototype.acos=Math.acos,t.prototype.asin=Math.asin,t.prototype.atan=Math.atan,t.prototype.atan2=Math.atan2,t.prototype.cos=Math.cos,t.prototype.sin=Math.sin,t.prototype.tan=Math.tan,t.prototype.abs=Math.abs,t.prototype.ceil=Math.ceil,t.prototype.exp=Math.exp,t.prototype.floor=Math.floor,t.prototype.log=Math.log,t.prototype.max=Math.max,t.prototype.min=Math.min,t.prototype.pow=Math.pow,t.prototype.random=Math.random,t.prototype.round=Math.round,t.prototype.sqrt=Math.sqrt,t.prototype.equals=function(t,e,i){return(i||u)>=h(t-e)},t.prototype.modulo=e=function(t,e){var i=t%e;return 0>i*e?i+e:i},t.prototype.standardRadian=n=function(t){return e(t,p)},t.prototype.standardAngle=o=function(t){return e(t,360)},t.prototype.sign=function(t){return t?0>t?-1:1:0},t.prototype.clamp=function(t,e,i){return e>t?e:t>i?i:t},t.prototype.clampBottom=function(t,e){return e>t?e:t},t.prototype.clampTop=function(t,e){return t>e?e:t},t.prototype.clamp01=i=function(t){return 0>t?0:t>1?1:t},t.prototype.lerp=function(t,e,n){return t+(e-t)*i(n)},t.prototype.lerpAngle=function(t,e,o){return n(t+(e-t)*i(o))},t.prototype.smoothStep=function(t,e,n){return t=(i(t)-e)/(n-e),t*t*(3-2*t)},t.prototype.smootherStep=function(t,e,n){return t=(i(t)-e)/(n-e),t*t*t*(t*(6*t-15)+10)},t.prototype.pingPong=function(t,e){return e||(e=1),e-h(t%(2*e)-e)},t.prototype.degsToRads=function(t){return n(t*d)},t.prototype.radsToDegs=function(t){return o(t*l)},t.prototype.randInt=function(t,e){return a(r(t,e+1))},t.prototype.randFloat=r=function(t,e){return t+s()*(e-t)},t.prototype.randChoice=function(t){return t[a(s()*t.length)]},t.prototype.randBool=function(){return.5>=s()?!1:!0},t.prototype.isPowerOfTwo=function(t){return(t&-t)===t},t.prototype.toPowerOfTwo=function(t){for(var e=2;t>e;)e*=2;return e},t.prototype.direction=function(t,e){return h(t)>=h(e)?t>0?"right":"left":e>0?"up":"down"},new t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/vec2",["math/mathf"],function(t){function e(t,e){this.x=0,this.y=0,t&&t.x?(this.x=t.x||0,this.y=t.y||0):(this.x=t||0,this.y=e||0)}var i=Math.abs,n=Math.sqrt,o=Math.acos,r=Math.sin,s=Math.cos,a=t.lerp,h=t.clamp,u=t.equals;return e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},e.prototype.set=function(t,e){return this.x=t,this.y=e,this},e.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.sadd=function(t){return this.x+=t,this.y+=t,this},e.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},e.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.ssub=function(t){return this.x-=t,this.y-=t,this},e.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this},e.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this},e.prototype.smul=function(t){return this.x*=t,this.y*=t,this},e.prototype.vdiv=function(t,e){var i=e.x,n=e.y;return this.x=0!==i?t.x/i:0,this.y=0!==n?t.y/n:0,this},e.prototype.div=function(t){var e=t.x,i=t.y;return this.x=0!==e?this.x/e:0,this.y=0!==i?this.y/i:0,this},e.prototype.sdiv=function(t){return t=0!==t?1/t:0,this.x*=t,this.y*=t,this},e.vdot=e.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.vlerp=function(t,e,i){return this.x=a(t.x,e.x,i),this.y=a(t.y,e.y,i),this},e.prototype.lerp=function(t,e){return this.x=a(this.x,t.x,e),this.y=a(this.y,t.y,e),this},e.prototype.vslerp=function(){var t=new e,i=new e,n=new e,a=new e;return function(e,u,c){var p=h(e.dot(u),-1,1),f=o(p)*c;return t.copy(e),i.copy(u),n.copy(t),a.vsub(i,n.smul(p)),a.norm(),this.vadd(t.smul(s(f)),a.smul(r(f)))}}(),e.prototype.slerp=function(){var t=new e,i=new e,n=new e,a=new e;return function(e,u){var c=h(this.dot(e),-1,1),p=o(c)*u;return t.copy(this),i.copy(e),n.copy(t),a.vsub(i,n.smul(c)),a.norm(),this.vadd(t.smul(s(p)),a.smul(r(p)))}}(),e.vcross=e.prototype.vcross=function(t,e){return t.x*e.y-t.y*e.x},e.prototype.cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.applyMat2=function(t){var e=t.elements,i=this.x,n=this.y;return this.x=i*e[0]+n*e[2],this.y=i*e[1]+n*e[3],this},e.prototype.applyMat32=function(t){var e=t.elements,i=this.x,n=this.y;return this.x=i*e[0]+n*e[2]+e[4],this.y=i*e[1]+n*e[3]+e[5],this},e.prototype.applyMat3=function(t){var e=t.elements,i=this.x,n=this.y;return this.x=i*e[0]+n*e[3]+e[6],this.y=i*e[1]+n*e[4]+e[7],this},e.prototype.applyMat4=function(t){var e=t.elements,i=this.x,n=this.y;return this.x=i*e[0]+n*e[4]+e[8]+e[12],this.y=i*e[1]+n*e[5]+e[9]+e[13],this},e.prototype.applyProj=function(t){var e=t.elements,i=this.x,n=this.y,o=1/(i*e[3]+n*e[7]+e[11]+e[15]);return this.x=(e[0]*i+e[4]*n+e[8]+e[12])*o,this.y=(e[1]*i+e[5]*n+e[9]+e[13])*o,this},e.prototype.applyQuat=function(t){var e=this.x,i=this.y,n=t.x,o=t.y,r=t.z,s=t.w,a=s*e+o-r*i,h=s*i+r*e-n,u=s+n*i-o*e,c=-n*e-o*i-r;return this.x=a*s+c*-n+h*-r-u*-o,this.y=h*s+c*-o+u*-n-a*-r,this},e.prototype.getPositionMat32=function(t){var e=t.elements;return this.x=e[4],this.y=e[5],this},e.prototype.getPositionMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this},e.prototype.getScaleMat32=function(t){var e=(t.elements,this.set(t[0],t[1]).len()),i=this.set(t[2],t[3]).len();return this.x=e,this.y=i,this},e.prototype.getScaleMat3=function(t){var e=t.elements,i=this.set(e[0],e[1],e[2]).len(),n=this.set(e[3],e[4],e[5]).len();return this.x=i,this.y=n,this},e.prototype.getScaleMat4=function(t){var e=t.elements,i=this.set(e[0],e[1],e[2]).len(),n=this.set(e[4],e[5],e[6]).len();return this.x=i,this.y=n,this},e.prototype.lenSq=function(){var t=this.x,e=this.y;return t*t+e*e},e.prototype.len=function(){var t=this.x,e=this.y;return n(t*t+e*e)},e.prototype.norm=function(){var t=this.x,e=this.y,i=t*t+e*e;return i=0!==i?1/n(i):0,this.x*=i,this.y*=i,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.perpL=function(){var t=this.x,e=this.y;return this.x=-e,this.y=t,this},e.prototype.perpR=function(){var t=this.x,e=this.y;return this.x=e,this.y=-t,this},e.prototype.abs=function(){return this.x=i(this.x),this.y=i(this.y),this},e.prototype.rotate=function(t){var e=this.x,i=this.y,n=s(t),o=r(t);return this.x=e*n-i*o,this.y=e*o+i*n,this},e.prototype.rotateAround=function(t,e){return this.sub(e).rotate(t).add(e)},e.prototype.min=function(t){var e=t.x,i=t.y;return this.x=this.x>e?e:this.x,this.y=this.y>i?i:this.y,this},e.prototype.max=function(t){var e=t.x,i=t.y;return this.x=e>this.x?e:this.x,this.y=i>this.y?i:this.y,this},e.prototype.clamp=function(t,e){return this.x=h(this.x,t.x,e.x),this.y=h(this.y,t.y,e.y),this},e.distSq=e.prototype.distSq=function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},e.dist=e.prototype.dist=function(t,e){var i=e.x-t.x,o=e.y-t.y,r=i*i+o*o;return 0!==r?n(r):0},e.prototype.toString=function(){return"Vec2( "+this.x+", "+this.y+" )"},e.prototype.equals=function(t,e){return!(!u(this.x,t.x,e)||!u(this.y,t.y,e))},e.equals=function(t,e,i){return!(!u(t.x,e.x,i)||!u(t.y,e.y,i))},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/aabb2",["math/mathf","math/vec2"],function(t,e){function i(t,n){this.min=new e,this.max=new e,t instanceof i?this.copy(t):(t&&this.min.copy(t),n&&this.max.copy(n))}var n=t.equals;return Math.abs,Math.cos,Math.sin,i.prototype.clone=function(){return new i(this.min.clone(),this.max.clone())},i.prototype.copy=function(t){var e=this.min,i=t.min,n=this.max,o=t.max;return e.x=i.x,e.y=i.y,n.x=o.x,n.y=o.y,this},i.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.prototype.setFromPoints=function(t){var e,i,n,o,r,s,a,h=t.length,u=this.min,c=this.max;if(h>0){for(i=n=1/0,o=r=-1/0;h--;)e=t[h],s=e.x,a=e.y,i=i>s?s:i,n=n>a?a:n,o=s>o?s:o,r=a>r?a:r;u.x=i,u.y=n,c.x=o,c.y=r}else u.x=u.y=c.x=c.y=0;return this},i.prototype.contains=function(t){var e=this.min,i=this.max,n=t.x,o=t.y;return!(e.x>n||n>i.x||e.y>o||o>i.y)},i.prototype.intersects=function(t){var e=this.min,i=this.max,n=t.min,o=t.max;return!(i.x<n.x||i.y<n.y||e.x>o.x||e.y>o.y)},i.prototype.toString=function(){var t=this.min,e=this.max;return"AABB2( min: "+t.x+", "+t.y+", max: "+e.x+", "+e.y+" )"},i.prototype.equals=function(t){var e=this.min,i=this.max,o=t.min,r=t.max;return!!(n(e.x,o.x)&&n(e.y,o.y)&&n(i.x,r.x)&&n(i.y,r.y))},i.intersects=function(t,e){var i=t.min,n=t.max,o=e.min,r=e.max;return!(n.x<o.x||n.y<o.y||i.x>r.x||i.y>r.y)},i.equals=function(t,e){var i=t.min,o=t.max,r=e.min,s=e.max;return!!(n(i.x,r.x)&&n(i.y,r.y)&&n(o.x,s.x)&&n(o.y,s.y))},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/vec3",["math/mathf"],function(t){function e(t,e,i){this.x=0,this.y=0,this.z=0,t&&t.x?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0):(this.x=t||0,this.y=e||0,this.z=i||0)}var i=Math.abs,n=Math.sqrt,o=Math.acos,r=Math.sin,s=Math.cos,a=t.lerp,h=t.clamp,u=t.equals;return e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},e.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.prototype.sadd=function(t){return this.x+=t,this.y+=t,this.z+=t,this},e.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},e.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.prototype.ssub=function(t){return this.x-=t,this.y-=t,this.z-=t,this},e.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},e.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},e.prototype.smul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.prototype.vdiv=function(t,e){var i=e.x,n=e.y,o=e.z;return this.x=0!==i?t.x/i:0,this.y=0!==n?t.y/n:0,this.z=0!==o?t.z/o:0,this},e.prototype.div=function(t){var e=t.x,i=t.y,n=t.z;return this.x=0!==e?this.x/e:0,this.y=0!==i?this.y/i:0,this.z=0!==n?this.z/n:0,this},e.prototype.sdiv=function(t){return t=0!==t?1/t:0,this.x*=t,this.y*=t,this.z*=t,this},e.vdot=e.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.vlerp=function(t,e,i){return this.x=a(t.x,e.x,i),this.y=a(t.y,e.y,i),this.z=a(t.z,e.z,i),this},e.prototype.lerp=function(t,e){return this.x=a(this.x,t.x,e),this.y=a(this.y,t.y,e),this.z=a(this.z,t.z,e),this},e.prototype.vslerp=function(){var t=new e,i=new e,n=new e,a=new e;return function(e,u,c){var p=h(e.dot(u),-1,1),f=o(p)*c;return t.copy(e),i.copy(u),n.copy(t),a.vsub(i,n.smul(p)),a.norm(),this.vadd(t.smul(s(f)),a.smul(r(f)))}}(),e.prototype.slerp=function(){var t=new e,i=new e,n=new e,a=new e;return function(e,u){var c=h(this.dot(e),-1,1),p=o(c)*u;return t.copy(this),i.copy(e),n.copy(t),a.vsub(i,n.smul(c)),a.norm(),this.vadd(t.smul(s(p)),a.smul(r(p)))}}(),e.vcross=e.prototype.vcross=function(t,e){var i=t.x,n=t.y,o=t.z,r=e.x,s=e.y,a=e.z;return this.x=n*a-o*s,this.y=o*r-i*a,this.z=i*s-n*r,this},e.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,o=t.x,r=t.y,s=t.z;return this.x=i*s-n*r,this.y=n*o-e*s,this.z=e*r-i*o,this},e.prototype.applyMat3=function(t){var e=t.elements,i=this.x,n=this.y,o=this.z;return this.x=i*e[0]+n*e[3]+o*e[6],this.y=i*e[1]+n*e[4]+o*e[7],this.z=i*e[2]+n*e[5]+o*e[8],this},e.prototype.applyMat4=function(t){var e=t.elements,i=this.x,n=this.y,o=this.z;return this.x=i*e[0]+n*e[4]+o*e[8]+e[12],this.y=i*e[1]+n*e[5]+o*e[9]+e[13],this.z=i*e[2]+n*e[6]+o*e[10]+e[14],this},e.prototype.applyProj=function(t){var e=t.elements,i=this.x,n=this.y,o=this.z,r=1/(i*e[3]+n*e[7]+o*e[11]+e[15]);return this.x=(e[0]*i+e[4]*n+e[8]+o*e[12])*r,this.y=(e[1]*i+e[5]*n+e[9]+o*e[13])*r,this.z=(e[2]*i+e[6]*n+e[10]+o*e[14])*r,this},e.prototype.applyQuat=function(t){var e=this.x,i=this.y,n=this.z,o=t.x,r=t.y,s=t.z,a=t.w,h=a*e+r*n-s*i,u=a*i+s*e-o*n,c=a*n+o*i-r*e,p=-o*e-r*i-s*n;return this.x=h*a+p*-o+u*-s-c*-r,this.y=u*a+p*-r+c*-o-h*-s,this.z=c*a+p*-s+h*-r-u*-o,this},e.prototype.getPositionMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this},e.prototype.getScaleMat3=function(t){var e=t.elements,i=this.set(e[0],e[1],e[2]).len(),n=this.set(e[3],e[4],e[5]).len(),o=this.set(e[6],e[7],e[8]).len();return this.x=i,this.y=n,this.y=o,this},e.prototype.getScaleMat4=function(t){var e=t.elements,i=this.set(e[0],e[1],e[2]).len(),n=this.set(e[4],e[5],e[6]).len(),o=this.set(e[8],e[9],e[10]).len();return this.x=i,this.y=n,this.z=o,this},e.prototype.lenSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},e.prototype.len=function(){var t=this.x,e=this.y,i=this.z;return n(t*t+e*e+i*i)},e.prototype.norm=function(){var t=this.x,e=this.y,i=this.z,o=t*t+e*e+i*i;return o=0!==o?1/n(o):0,this.x*=o,this.y*=o,this.z*=o,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.prototype.abs=function(){return this.x=i(this.x),this.y=i(this.y),this.z=i(this.z),this},e.prototype.min=function(t){var e=t.x,i=t.y,n=t.z;return this.x=this.x>e?e:this.x,this.y=this.y>i?i:this.y,this.z=this.z>n?n:this.z,this},e.prototype.max=function(t){var e=t.x,i=t.y,n=t.z;return this.x=e>this.x?e:this.x,this.y=i>this.y?i:this.y,this.z=n>this.z?n:this.z,this},e.prototype.clamp=function(t,e){return this.x=h(this.x,t.x,e.x),this.y=h(this.y,t.y,e.y),this.z=h(this.z,t.z,e.z),this},e.distSq=e.prototype.distSq=function(t,e){var i=e.x-t.x,n=e.y-t.y,o=e.z-t.z;return i*i+n*n+o*o},e.dist=e.prototype.dist=function(t,e){var i=e.x-t.x,o=e.y-t.y,r=e.z-t.z,s=i*i+o*o+r*r;return 0!==s?n(s):0},e.prototype.toString=function(){return"Vec3( "+this.x+", "+this.y+", "+this.z+" )"},e.prototype.equals=function(t,e){return!(!u(this.x,t.x,e)||!u(this.y,t.y,e)||!u(this.z,t.z,e))},e.equals=function(t,e,i){return!(!u(t.x,e.x,i)||!u(t.y,e.y,i)||!u(t.z,e.z,i))},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/aabb3",["math/mathf","math/vec3"],function(t,e){function i(t,n){this.min=new e,this.max=new e,t instanceof i?this.copy(t):(t&&this.min.copy(t),n&&this.max.copy(n))}var n=t.equals;return Math.abs,Math.cos,Math.sin,i.prototype.clone=function(){return new i(this.min.clone(),this.max.clone())},i.prototype.copy=function(t){var e=this.min,i=t.min,n=this.max,o=t.max;return e.x=i.x,e.y=i.y,e.z=i.z,n.x=o.x,n.y=o.y,n.z=o.z,this},i.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.prototype.setFromPoints=function(t){var e,i,n,o,r,s,a,h,u,c,p=t.length,f=this.min,d=this.max;if(il>0){for(i=n=o=1/0,r=s=a=-1/0;p--;)e=t[p],h=e.x,u=e.y,c=e.z,i=i>h?h:i,n=n>u?u:n,o=o>c?c:o,r=h>r?h:r,s=u>s?u:s,a=c>a?c:a;f.x=i,f.y=n,f.x=o,d.x=r,d.y=s,d.x=a}else f.x=f.y=f.z=d.x=d.y=d.z=0;return this},i.prototype.contains=function(t){var e=(this.min,this.max,t.x),i=t.y,n=t.z;return!(this.min.x>e||e>this.max.x||this.min.y>i||i>this.max.y||this.min.z>n||n>this.max.z)},i.prototype.intersects=function(t){var e=this.min,i=this.max,n=t.min,o=t.max;return!(i.x<n.x||i.y<n.y||e.x>o.x||e.y>o.y||e.z>o.z||e.z>o.z)},i.prototype.toString=function(){var t=this.min,e=this.max;return"AABB3( min: "+t.x+", "+t.y+", "+t.z+", max: "+e.x+", "+e.y+", "+e.z+" )"},i.prototype.equals=function(t){var e=this.min,i=this.max,o=t.min,r=t.max;return!!(n(e.x,o.x)&&n(e.y,o.y)&&n(e.z,o.z)&&n(i.x,r.x)&&n(i.y,r.y)&&n(i.z,r.z))},i.intersects=function(t,e){var i=t.min,n=t.max,o=e.min,r=e.max;return!(n.x<o.x||n.y<o.y||n.z<o.z||i.x>r.x||i.y>r.y||i.z>r.z)},i.equals=function(t,e){var i=t.min,o=t.max,r=e.min,s=e.max;return!!(n(i.x,r.x)&&n(i.y,r.y)&&n(i.z,r.z)&&n(o.x,s.x)&&n(o.y,s.y)&&n(o.z,s.z))},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/color",["math/mathf"],function(t){function e(t,e,i,n){this.r=0,this.g=0,this.b=0,this.a=1,this._cache={rgb:"rgb( 0, 0, 0 )",rgba:"rgba( 0, 0, 0, 1 )",hex:"#000000"},this.set(t||0,e||0,i||0,void 0!==n?n:1)}var i=Math.abs,n=Math.floor,o=(Math.sqrt,t.lerp),r=t.equals;e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copy=function(t){var e=this._cache,i=t._cache;return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,e.hex=i.hex,e.rgb=i.rgb,e.rgba=i.rgba,this},e.prototype.set=function(t,e,i,n){return"number"==typeof t?this.setArgs(t,e,i,n):"string"==typeof t?this.setString(t):(this.set(0,0,0,1),console.warn("Color.set: Invalid input")),this},e.prototype.setString=function(){function t(t){return t.match(n)}function e(t){return o.test(t)}var i,n=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/,o=/#(.)(.)(.)/;return function(n){return i=s[n.toLowerCase()],e(n)?this.setHex(n):t(n)?this.setRgb(n):i?this.setHex(i):(this.set(0,0,0,1),console.warn("Color.setString: Invalid String")),this}}(),e.prototype.setArgs=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this._updateCache(),this},e.prototype.setRgb=function(){function t(t){return t.match(e)}var e=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/;return function(e){return e=t(e),e?(this.r=Number(e[2])/255,this.g=Number(e[4])/255,this.b=Number(e[6])/255,this.a=Number(e[8])||1):(this.set(0,0,0,1),console.warn("Color.setRgb: Invalid rgb")),this._updateCache(),this}}(),e.prototype.setHex=function(){function t(t){return 4===t.length&&(t=t.replace(i,o)),t.toLowerCase(),t}function e(t){return n.test(t)}var i=/#(.)(.)(.)/,n=/^#(?:[0-9a-f]{3}){1,2}$/i,o="#$1$1$2$2$3$3";return function(i){return e(i)?(t(i),this.r=parseInt(i.substr(1,2),16)/255,this.g=parseInt(i.substr(3,2),16)/255,this.b=parseInt(i.substr(5,2),16)/255,this.a=1):(this.set(0,0,0,1),console.warn("Color.setHex: Invalid hex")),this._updateCache(),this}}(),e.prototype._updateCache=function(){function t(t){return i=n(255*t),o=parseInt(i).toString(16),0===i?o="00":i>0&&15>i&&(o="0"+o),o}var e,i,o;return function(){e=this._cache;var i=t(this.r),o=t(this.g),r=t(this.b),s=n(256*this.r),a=n(256*this.g),h=n(256*this.b),u=n(this.a);return e.rgb="rgb( "+s+", "+a+", "+h+" )",e.rgba="rgba( "+s+", "+a+", "+h+", "+u+" )",e.hex="#"+i+o+r,this}}(),e.prototype.hex=function(){return this._cache.hex},e.prototype.rgb=function(){return 1===this.a?this._cache.rgb:this._cache.rgba},e.prototype.rgba=function(){return this._cache.rgba},e.prototype.smul=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},e.prototype.sdiv=function(t){return t=0!==t?1/t:0,this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},e.prototype.clerp=function(t,e,i){return this.r=o(t.r,e.r,i),this.g=o(t.g,e.g,i),this.b=o(t.b,e.b,i),this.a=o(t.a,e.a,i),this},e.prototype.lerp=function(t,e){return this.r=o(this.r,t.r,e),this.g=o(this.g,t.g,e),this.b=o(this.b,t.b,e),this.a=o(this.a,t.a,e),this},e.prototype.abs=function(){return this.r=i(this.r),this.g=i(this.g),this.b=i(this.b),this.a=i(this.a),this},e.prototype.min=function(t){var e=t.r,i=t.g,n=t.b,o=t.a;return this.r=this.r>e?e:this.r,this.g=this.g>i?i:this.g,this.b=this.b>n?n:this.b,this.a=this.a>o?o:this.a,this},e.prototype.max=function(t){var e=t.r,i=t.g,n=t.b,o=t.a;return this.r=e>this.r?e:this.r,this.g=i>this.g?i:this.g,this.b=n>this.b?n:this.b,this.a=o>this.a?o:this.a,this},e.prototype.clamp=function(t,e){return this.r=clamp(this.r,t.r,e.r),this.g=clamp(this.g,t.g,e.g),this.b=clamp(this.b,t.b,e.b),this.a=clamp(this.a,t.a,e.a),this},e.prototype.toString=function(){return"Color( "+this.r+", "+this.g+", "+this.b+", "+this.a+" )"},e.prototype.equals=function(t,e){return!!(r(this.r,t.r,e)&&r(this.g,t.g,e)&&r(this.b,t.b,e)&&r(this.a,t.a,e))},e.equals=function(t,e,i){return!!(r(t.r,e.r,i)&&r(t.g,e.g,i)&&r(t.b,e.b,i)&&r(t.a,e.a,i))};var s={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/line2",["math/mathf","math/vec2"],function(t,e){function i(t,i){this.start=t instanceof e?t:new e,this.end=i instanceof e?i:new e}var n=Math.sqrt,o=t.clamp01,r=t.equals;return i.prototype.clone=function(){return new i(this.start.clone(),this.end.clone())},i.prototype.copy=function(t){var e=this.start,i=this.end,n=t.start,n=t.end;return e.x=n.x,e.y=n.y,i.x=oe.x,i.y=oe.y,this},i.prototype.set=function(t,e){var i=this.start,n=this.end;return i.x=t.x,i.y=t.y,n.x=e.x,n.y=e.y,this},i.prototype.add=function(t){var e=this.start,i=this.end,n=t.x,o=t.y;return e.x+=n,e.y+=o,i.x+=n,i.y+=o,this},i.prototype.sadd=function(t){var e=this.start,i=this.end;return e.x+=t,e.y+=t,i.x+=t,i.y+=t,this},i.prototype.sub=function(t){var e=this.start,i=this.end,n=t.x,o=t.y;return e.x-=n,e.y-=o,i.x-=n,i.y-=o,this},i.prototype.ssub=function(t){var e=this.start,i=this.end;return e.x-=t,e.y-=t,i.x-=t,i.y-=t,this},i.prototype.mul=function(t){var e=this.start,i=this.end,n=t.x,o=t.y;return e.x*=n,e.y*=o,i.x*=n,i.y*=o,this},i.prototype.smul=function(t){var e=this.start,i=this.end;return e.x*=t,e.y*=t,i.x*=t,i.y*=t,this
},i.prototype.div=function(t){var e=this.start,i=this.end,n=0!==t.x?1/t.x:0,o=0!==t.y?1/t.y:0;return e.x*=n,e.y*=o,i.x*=n,i.y*=o,this},i.prototype.sdiv=function(t){var e=this.start,i=this.end;return t=0!==t?1/t:0,e.x*=t,e.y*=t,i.x*=t,i.y*=t,this},i.prototype.ldotv=function(t,e){var i=t.start,n=t.end,o=n.x-i.x,r=n.y-i.y;return o*e.x+r*e.y},i.prototype.dot=function(t){var e=this.start,i=this.end,n=i.x-e.x,o=i.y-e.y;return n*t.x+o*t.y},i.prototype.lenSq=function(){var t=this.start,e=this.end,i=e.x-t.x,n=e.y-t.y;return i*i+n*n},i.prototype.len=function(){var t=this.start,e=this.end,i=e.x-t.x,o=e.y-t.y;return n(i*i+o*o)},i.prototype.center=function(t){t=t||new e;var i=this.start,n=this.end;return t.x=.5*(i.x+n.x),t.y=.5*(i.y+n.y),t},i.prototype.delta=function(t){t=t||new e;var i=this.start,n=this.end;return t.x=n.x-i.x,t.y=n.y-i.y,t},i.prototype.norm=function(){var t=this.start,e=this.end,i=t.x,o=t.y,r=i*i+o*o,s=e.x,a=e.y,h=s*s+a*a;return r=0!==r?1/n(r):0,t.x*=r,t.y*=r,h=0!==h?1/n(h):0,e.x*=h,e.y*=h,this},i.prototype.closestPoint=function(t,i){i=i||new e;var n=this.start,r=this.end,s=n.x,a=n.y,h=r.x,u=r.y,c=h-s,p=u-a,f=t.x-s,d=t.y-a,l=o((c*f+p*d)/(c*c+p*p));return i.x=c*l+s,i.y=p*l+a,i},i.prototype.intersect=function(t,i){i=i||new e;var n,o,r=this.start,s=this.end,a=r.x,h=r.y,u=s.x,c=s.y,p=t.start,f=t.end,d=p.x,l=p.y,m=f.x,y=f.y,v=(a-u)*(l-y)-(h-c)*(d-m);return 0===v?i:(n=a*c-h*u,o=d*y-l*m,i.x=(n*(d-y)-(a-u)*o)/v,i.y=(n*(l-y)-(h-c)*o)/v,i)},i.prototype.toString=function(){var t=this.start,e=this.end;return"Line2( start: "+t.x+", "+t.y+", end: "+e.x+", "+e.y+" )"},i.prototype.equals=function(t){var e=this.start,i=this.end,n=t.start,o=t.end;return!!(r(e.x,n.x)&&r(e.y,n.y)&&r(i.x,o.x)&&r(i.y,o.y))},i.equals=function(t,e){var i=t.start,n=t.end,o=e.start,s=e.end;return!!(r(i.x,o.x)&&r(i.y,o.y)&&r(n.x,s.x)&&r(n.y,s.y))},i.intersect=function(t,i,n){n=n||new e;var o,r,s=t.start,a=t.end,h=s.x,u=s.y,c=a.x,p=a.y,f=i.start,d=i.end,l=f.x,m=f.y,y=d.x,v=d.y,x=(h-c)*(m-v)-(u-p)*(l-y);return 0===x?n:(o=h*p-u*c,r=l*v-m*y,n.x=(o*(l-v)-(h-c)*r)/x,n.y=(o*(m-v)-(u-p)*r)/x,n)},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/mat2",["math/mathf"],function(t){function e(t,e,i,n){this.elements=new Float32Array(4),t&&t.elements?this.copy(t):this.set(t||1,e||0,i||0,n||1)}var i=Math.abs,n=Math.sin,o=Math.cos,r=Math.atan2,s=t.lerp,a=t.equals;return e.prototype.clone=function(){var t=this.elements;return new e(t[0],t[2],t[1],t[3])},e.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this},e.prototype.set=function(t,e,i,n){var o=this.elements;return o[0]=t,o[2]=e,o[1]=i,o[3]=n,this},e.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,this},e.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,this},e.prototype.mmul=function(t,e){var i=this.elements,n=t.elements,o=e.elements,r=n[0],s=n[2],a=n[1],h=n[3],u=o[0],c=o[2],p=o[1],f=o[3];return i[0]=r*u+s*p,i[2]=r*c+s*f,i[1]=a*u+h*p,i[3]=a*c+h*f,this},e.prototype.mul=function(t){var e=this.elements,i=t.elements,n=e[0],o=e[2],r=e[1],s=e[3],a=i[0],h=i[2],u=i[1],c=i[3];return e[0]=n*a+o*u,e[1]=n*h+o*c,e[2]=r*a+s*u,e[3]=r*h+s*c,this},e.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},e.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},e.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[2],e[2]=t,this},e.prototype.setTrace=function(t){var e=this.elements;return e[0]=t.x,e[3]=t.y,this},e.prototype.minv=function(t){var e=this.elements,i=t.elements,n=i[0],o=i[2],r=i[1],s=i[3],a=n*s-o*r;return a=0!==a?1/a:0,e[0]=s*a,e[1]=-o*a,e[2]=-r*a,e[3]=n*a,this},e.prototype.inv=function(){var t=this.elements,e=t[0],i=t[2],n=t[1],o=t[3],r=e*o-i*n;return r=0!==r?1/r:0,t[0]=o*r,t[1]=-i*r,t[2]=-n*r,t[3]=e*r,this},e.prototype.mlerp=function(t,e,i){var n=this.elements,o=t.elements,r=e.elements;return n[0]=s(o[0],r[0],i),n[1]=s(o[1],r[1],i),n[2]=s(o[2],r[2],i),n[3]=s(o[3],r[3],i),this},e.prototype.lerp=function(t,e){var i=this.elements,n=t.elements;return i[0]=s(i[0],n[0],e),i[1]=s(i[1],n[1],e),i[2]=s(i[2],n[2],e),i[3]=s(i[3],n[3],e),this},e.prototype.abs=function(){var t=this.elements;return t[0]=i(t[0]),t[1]=i(t[1]),t[2]=i(t[2]),t[3]=i(t[3]),this},e.prototype.setRotation=function(t){var e=this.elements,i=o(t),r=n(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,this},e.prototype.getRotation=function(){var t=this.elements;return r(t[1],t[0])},e.prototype.rotate=function(t){var e=this.elements,i=e[0],o=e[2],r=e[1],s=e[3],a=n(t),h=n(t);return e[0]=i*h+o*a,e[1]=i*-a+o*h,e[2]=r*h+s*a,e[3]=r*-a+s*h,this},e.prototype.toString=function(){var t=this.elements;return"Mat2[ "+t[0]+", "+t[2]+"]\n"+"     [ "+t[1]+", "+t[3]+"]"},e.prototype.equals=function(t){var e=this.elements,i=t.elements;return!!(a(e[0],i[0])&&a(e[1],i[1])&&a(e[2],i[2])&&a(e[3],i[3]))},e.equals=function(t,e){var i=t.elements,n=e.elements;return!!(a(i[0],n[0])&&a(i[1],n[1])&&a(i[2],n[2])&&a(i[3],n[3]))},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/mat3",["math/mathf"],function(t){function e(t,e,i,n,o,r,s,a,h){this.elements=new Float32Array(9),t&&t.elements?this.copy(t):this.set(t||1,e||0,i||0,n||0,o||1,r||0,s||0,a||0,h||1)}var i=Math.abs,n=(Math.sin,Math.cos,t.lerp),o=t.equals;return e.prototype.clone=function(){var t=this.elements;return new e(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},e.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},e.prototype.set=function(t,e,i,n,o,r,s,a,h){var u=this.elements;return u[0]=t,u[3]=e,u[6]=i,u[1]=n,u[4]=o,u[7]=r,u[2]=s,u[5]=a,u[8]=h,this},e.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},e.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,this},e.prototype.mmul=function(t,e){var i=this.elements,n=t.elements,o=e.elements,r=n[0],s=n[3],a=n[6],h=n[1],u=n[4],c=n[7],p=n[2],f=n[5],d=n[8],l=o[0],m=o[3],y=o[6],v=o[1],x=o[4],g=o[7],w=o[2],b=o[5],z=o[8];return i[0]=r*l+s*v+a*w,i[3]=r*m+s*x+a*b,i[6]=r*y+s*g+a*z,i[1]=h*l+u*v+c*w,i[4]=h*m+u*x+c*b,i[7]=h*y+u*g+c*z,i[2]=p*l+f*v+d*w,i[5]=p*m+f*x+d*b,i[8]=p*y+f*g+d*z,this},e.prototype.mul=function(t){var e=this.elements,i=t.elements,n=e[0],o=e[3],r=e[6],s=e[1],a=e[4],h=e[7],u=e[2],c=e[5],p=e[8],f=i[0],d=i[3],l=i[6],m=i[1],y=i[4],v=i[7],x=i[2],g=i[5],w=i[8];return e[0]=n*f+o*m+r*x,e[3]=n*d+o*y+r*g,e[6]=n*l+o*v+r*w,e[1]=s*f+a*m+h*x,e[4]=s*d+a*y+h*g,e[7]=s*l+a*v+h*w,e[2]=u*f+c*m+p*x,e[5]=u*d+c*y+p*g,e[8]=u*l+c*v+p*w,this},e.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},e.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},e.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},e.prototype.setTrace=function(t){var e=this.elements;return e[0]=t.x,e[4]=t.y,e[8]=t.z||1,this},e.prototype.minv=function(t){var e=this.elements,i=t.elements,n=i[0],o=i[3],r=i[6],s=i[1],a=i[4],h=i[7],u=i[2],c=i[5],p=i[8];return e[0]=a*p-h*c,e[1]=h*u-s*p,e[2]=s*c-a*u,e[3]=r*c-o*p,e[4]=n*p-r*u,e[5]=o*u-n*c,e[6]=o*h-r*a,e[7]=r*s-n*h,e[8]=n*a-o*s,this.sdiv(n*e[0]+s*e[3]+u*e[6]),this},e.prototype.invMat4=function(t){var e=this.elements,i=t.elements,n=i[0],o=i[4],r=i[8],s=(i[12],i[1]),a=i[5],h=i[9],u=(i[13],i[2]),c=i[6],p=i[10];return i[14],i[3],i[7],i[11],i[15],e[0]=p*a-c*h,e[1]=-p*s+u*h,e[2]=c*s-u*a,e[3]=-p*o+c*r,e[4]=p*n-u*r,e[5]=-c*n+u*o,e[6]=h*o-a*r,e[7]=-h*n+s*r,e[8]=a*n-s*o,this.sdiv(n*e[0]+s*e[3]+u*e[6]),this},e.prototype.inv=function(){var t=this.elements,e=t[0],i=t[3],n=t[6],o=t[1],r=t[4],s=t[7],a=t[2],h=t[5],u=t[8];return t[0]=r*u-s*h,t[1]=s*a-o*u,t[2]=o*h-r*a,t[3]=n*h-i*u,t[4]=e*u-n*a,t[5]=i*a-e*h,t[6]=i*s-n*r,t[7]=n*o-e*s,t[8]=e*r-i*o,this.sdiv(e*t[0]+o*t[3]+a*t[6]),this},e.prototype.mlerp=function(t,e,i){var o=this.elements,r=t.elements,s=e.elements;return o[0]=n(r[0],s[0],i),o[1]=n(r[1],s[1],i),o[2]=n(r[2],s[2],i),o[3]=n(r[3],s[3],i),o[4]=n(r[4],s[4],i),o[5]=n(r[5],s[5],i),o[6]=n(r[6],s[6],i),o[7]=n(r[7],s[7],i),o[8]=n(r[8],s[8],i),this},e.prototype.lerp=function(t,e){var i=this.elements,o=t.elements;return i[0]=n(i[0],o[0],e),i[1]=n(i[1],o[1],e),i[2]=n(i[2],o[2],e),i[3]=n(i[3],o[3],e),i[4]=n(i[4],o[4],e),i[5]=n(i[5],o[5],e),i[6]=n(i[6],o[6],e),i[7]=n(i[7],o[7],e),i[8]=n(i[8],o[8],e),this},e.prototype.abs=function(){var t=this.elements;return t[0]=i(t[0]),t[1]=i(t[1]),t[2]=i(t[2]),t[3]=i(t[3]),t[4]=i(t[4]),t[5]=i(t[5]),t[6]=i(t[6]),t[7]=i(t[7]),t[8]=i(t[8]),this},e.prototype.setRotationQuat=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z,r=t.w,s=i+i,a=n+n,h=o+o,u=i*s,c=i*a,p=i*h,f=n*a,d=n*h,l=o*h,m=r*s,y=r*a,v=r*h;return e[0]=1-(f+l),e[3]=c-v,e[6]=p+y,e[1]=c+v,e[4]=1-(u+l),e[7]=d-m,e[2]=p-y,e[5]=d+m,e[8]=1-(u+f),this},e.prototype.rotateAxis=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z;return t.x=i*e[0]+n*e[3]+o*e[6],t.y=i*e[1]+n*e[4]+o*e[7],t.z=i*e[2]+n*e[5]+o*e[8],t.norm(),t},e.prototype.scale=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z;return e[0]*=i,e[3]*=n,e[6]*=o,e[1]*=i,e[4]*=n,e[7]*=o,e[2]*=i,e[5]*=n,e[8]*=o,this},e.prototype.toString=function(){var t=this.elements;return"Mat3["+t[0]+", "+t[3]+", "+t[6]+"]\n"+"     ["+t[1]+", "+t[4]+", "+t[7]+"]\n"+"     ["+t[2]+", "+t[5]+", "+t[8]+"]"},e.prototype.equals=function(t){var e=this.elements,i=t.elements;return!!(o(e[0],i[0])&&o(e[1],i[1])&&o(e[2],i[2])&&o(e[3],i[3])&&o(e[4],i[4])&&o(e[5],i[5])&&o(e[6],i[6])&&o(e[7],i[7])&&o(e[8],i[8]))},e.equals=function(t,e){var i=t.elements,n=e.elements;return!!(o(i[0],n[0])&&o(i[1],n[1])&&o(i[2],n[2])&&o(i[3],n[3])&&o(i[4],n[4])&&o(i[5],n[5])&&o(i[6],n[6])&&o(i[7],n[7])&&o(i[8],n[8]))},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/mat32",["math/mathf","math/vec2"],function(t){function e(t,e,i,n,o,r){this.elements=new Float32Array(6),t&&t.elements?this.copy(t):this.set(t||1,e||0,i||0,n||0,o||1,r||0)}var i=Math.abs,n=Math.sin,o=Math.cos,r=t.lerp,s=t.equals;return e.prototype.clone=function(){var t=this.elements;return new e(t[0],t[2],t[4],t[1],t[3],t[5])},e.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],this},e.prototype.set=function(t,e,i,n,o,r){var s=this.elements;return s[0]=t,s[2]=e,s[4]=i,s[1]=n,s[3]=o,s[5]=r,this},e.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this},e.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,this},e.prototype.mmul=function(t,e){var i=this.elements,n=t.elements,o=e.elements,r=n[0],s=n[2],a=n[4],h=n[1],u=n[3],c=n[5],p=o[0],f=o[2],d=o[4],l=o[1],m=o[3],y=o[5];return i[0]=r*p+s*l,i[2]=r*f+s*m,i[1]=h*p+u*l,i[3]=h*f+u*m,i[4]=a*p+c*l+d,i[5]=a*f+c*m+y,this},e.prototype.mul=function(t){var e=this.elements,i=t.elements,n=e[0],o=e[2],r=e[4],s=e[1],a=e[3],h=e[5],u=i[0],c=i[2],p=i[4],f=i[1],d=i[3],l=i[5];return e[0]=n*u+o*f,e[2]=n*c+o*d,e[1]=s*u+a*f,e[3]=s*c+a*d,e[4]=r*u+h*f+p,e[5]=r*c+h*d+l,this},e.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,this},e.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,this},e.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[2],e[2]=t,this},e.prototype.setTrace=function(t){var e=this.elements;return e[0]=t.x,e[3]=t.y,this},e.prototype.minv=function(t){var e=this.elements,i=t.elements,n=i[0],o=i[2],r=i[4],s=i[1],a=i[3],h=i[5],u=n*a-o*s;return u=0!==u?1/u:0,e[0]=a,e[1]=-o,e[2]=-s,e[3]=n,e[4]=o*h-a*r,e[5]=s*r-n*h,this.smul(u),this},e.prototype.inv=function(){var t=this.elements,e=t[0],i=t[2],n=t[4],o=t[1],r=t[3],s=t[5],a=e*r-i*o;return a=0!==a?1/a:0,t[0]=r,t[1]=-i,t[2]=-o,t[3]=e,t[4]=i*s-r*n,t[5]=o*n-e*s,this.smul(a),this},e.prototype.mlerp=function(t,e,i){var n=this.elements,o=t.elements,s=e.elements;return n[0]=r(o[0],s[0],i),n[1]=r(o[1],s[1],i),n[2]=r(o[2],s[2],i),n[3]=r(o[3],s[3],i),n[4]=r(o[4],s[4],i),n[5]=r(o[5],s[5],i),this},e.prototype.lerp=function(t,e){var i=this.elements,n=t.elements;return i[0]=r(i[0],n[0],e),i[1]=r(i[1],n[1],e),i[2]=r(i[2],n[2],e),i[3]=r(i[3],n[3],e),i[4]=r(i[4],n[4],e),i[5]=r(i[5],n[5],e),this},e.prototype.abs=function(){var t=this.elements;return t[0]=i(t[0]),t[1]=i(t[1]),t[2]=i(t[2]),t[3]=i(t[3]),t[4]=i(t[4]),t[5]=i(t[5]),this},e.prototype.setTranslation=function(t){var e=this.elements;return e[4]=t.x,e[5]=t.y,this},e.prototype.setRotation=function(t){var e=this.elements,i=o(t),r=n(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,this},e.prototype.getTranslation=function(t){var e=this.elements;return t.x=e[4],t.y=e[5],t},e.prototype.getRotation=function(){var t=this.elements;return atan2(t[1],t[0])},e.prototype.extractPosition=function(t){var e=this.elements,i=t.elements;return e[4]=i[4],e[5]=i[5],this},e.prototype.extractRotation=function(t){var e=this.elements,i=t.elements,n=i[0],o=i[2],r=i[1],s=i[3],a=n*n+r*r,h=o*o+s*s,u=0!==a?1/sqrt(a):0,c=0!==h?1/sqrt(h):0;return e[0]=n*u,e[1]=r*u,e[2]=o*c,e[3]=s*c,this},e.prototype.lookAt=function(t,e){var i=this.elements,r=e.x-t.x,s=e.y-t.y,a=atan2(s,r)-HALF_PI,h=o(a),u=n(a);return i[0]=h,i[1]=u,i[2]=-u,i[3]=h,this},e.prototype.translate=function(t){var e=this.elements,i=t.x,n=t.y;return e[4]=e[0]*i+e[2]*n+e[4],e[5]=e[1]*i+e[3]*n+e[5],this},e.prototype.scale=function(t){var e=this.elements,i=t.x,n=t.y;return e[0]*=i,e[1]*=i,e[4]*=i,e[2]*=n,e[3]*=n,e[5]*=n,this},e.prototype.rotate=function(t){var e=this.elements,i=e[0],o=e[2],r=e[4],s=e[1],a=e[3],h=e[5],u=n(t),c=n(t);return e[0]=i*c-o*u,e[1]=i*u+o*c,e[2]=s*c-a*u,e[3]=s*u+a*c,e[4]=r*c-h*u,e[5]=r*u+h*c,this},e.prototype.skew=function(t){var e=this.elements,i=t.x,n=t.y;return e[1]+=i,e[2]+=n,this},e.prototype.orthographic=function(t,e,i,n){var o=this.elements,r=1/(e-t),s=1/(i-n),a=-(e+t)*r,h=-(i+n)*s;return o[0]=2*r,o[1]=0,o[2]=0,o[3]=2*-s,o[4]=a,o[5]=h,this},e.prototype.toString=function(){var t=this.elements;return"Mat32[ "+t[0]+", "+t[2]+", "+t[4]+"]\n"+"     [ "+t[1]+", "+t[3]+", "+t[5]+"]"},e.prototype.equals=function(t){var e=this.elements,i=t.elements;return!!(s(e[0],i[0])&&s(e[1],i[1])&&s(e[2],i[2])&&s(e[3],i[3])&&s(e[4],i[4])&&s(e[5],i[5]))},e.equals=function(t,e){var i=t.elements,n=e.elements;return!!(s(i[0],n[0])&&s(i[1],n[1])&&s(i[2],n[2])&&s(i[3],n[3])&&s(i[4],n[4])&&s(i[5],n[5]))},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/mat4",["math/mathf","math/vec3"],function(t,e){function i(t,e,i,n,o,r,s,a,h,u,c,p,f,d,l,m){this.elements=new Float32Array(16),t&&t.elements?this.copy(t):this.set(t||1,e||0,i||0,n||0,o||0,r||1,s||0,a||0,h||0,u||0,c||1,p||0,f||0,d||0,l||0,m||1)}var n=Math.abs,o=Math.sin,r=Math.cos,s=Math.tan,h=t.lerp,u=t.equals,c=t.degsToRads;return i.prototype.clone=function(){var t=this.elements;return new i(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},i.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},i.prototype.set=function(t,e,i,n,o,r,s,a,h,u,c,p,f,d,l,m){var y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=n,y[1]=o,y[5]=r,y[9]=s,y[13]=a,y[2]=h,y[6]=u,y[10]=c,y[14]=p,y[3]=f,y[7]=d,y[11]=l,y[15]=m,this},i.prototype.fromMat32=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[4]=i[2],e[5]=i[3],e[12]=i[4],e[13]=i[5],this},i.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,this},i.prototype.mmul=function(t,e){var i=this.elements,n=t.elements,o=e.elements,r=n[0],s=n[4],a=n[8],h=n[12],u=n[1],c=n[5],p=n[9],f=n[13],d=n[2],l=n[6],m=n[10],y=n[14],v=n[3],x=n[7],g=n[11],w=n[15],b=o[0],z=o[4],A=o[8],_=o[12],S=o[1],E=o[5],C=o[9],M=o[13],T=o[2],O=o[6],R=o[10],q=o[14],P=o[3],D=o[7],B=o[11],j=o[15];return i[0]=r*b+s*S+a*T+h*P,i[1]=u*b+c*S+p*T+f*P,i[2]=d*b+l*S+m*T+y*P,i[3]=v*b+x*S+g*T+w*P,i[4]=r*z+s*E+a*O+h*D,i[5]=u*z+c*E+p*O+f*D,i[6]=d*z+l*E+m*O+y*D,i[7]=v*z+x*E+g*O+w*D,i[8]=r*A+s*C+a*R+h*B,i[9]=u*A+c*C+p*R+f*B,i[10]=d*A+l*C+m*R+y*B,i[11]=v*A+x*C+g*R+w*B,i[12]=r*_+s*M+a*q+h*j,i[13]=u*_+c*M+p*q+f*j,i[14]=d*_+l*M+m*q+y*j,i[15]=v*_+x*M+g*q+w*j,this},i.prototype.mul=function(){var t=a.elements,e=b.elements,i=t[0],n=t[4],o=t[8],r=t[12],s=t[1],h=t[5],u=t[9],c=t[13],p=t[2],f=t[6],d=t[10],l=t[14],m=t[3],y=t[7],v=t[11],x=t[15],g=e[0],w=e[4],z=e[8],A=e[12],_=e[1],S=e[5],E=e[9],C=e[13],M=e[2],T=e[6],O=e[10],R=e[14],q=e[3],P=e[7],D=e[11],B=e[15];return t[0]=i*g+n*_+o*M+r*q,t[1]=s*g+h*_+u*M+c*q,t[2]=p*g+f*_+d*M+l*q,t[3]=m*g+y*_+v*M+x*q,t[4]=i*w+n*S+o*T+r*P,t[5]=s*w+h*S+u*T+c*P,t[6]=p*w+f*S+d*T+l*P,t[7]=m*w+y*S+v*T+x*P,t[8]=i*z+n*E+o*O+r*D,t[9]=s*z+h*E+u*O+c*D,t[10]=p*z+f*E+d*O+l*D,t[11]=m*z+y*E+v*O+x*D,t[12]=i*A+n*C+o*R+r*B,t[13]=s*A+h*C+u*R+c*B,t[14]=p*A+f*C+d*R+l*B,t[15]=m*A+y*C+v*R+x*B,this},i.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,this},i.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,this},i.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},i.prototype.setTrace=function(t){var e=this.elements;return e[0]=t.x,e[5]=t.y,e[10]=t.z||1,e[15]=t.w||1,this},i.prototype.minv=function(t){var e=this.elements,i=t.elements,n=i[0],o=i[4],r=i[8],s=i[12],a=i[1],h=i[5],u=i[9],c=i[13],p=i[2],f=i[6],d=i[10],l=i[14],m=i[3],y=i[7],v=i[11],x=i[15];return e[0]=u*l*y-c*d*y+c*f*v-h*l*v-u*f*x+h*d*x,e[1]=c*d*m-u*l*m-c*p*v+a*l*v+u*p*x-a*d*x,e[2]=h*l*m-c*f*m+c*p*y-a*l*y-h*p*x+a*f*x,e[3]=u*f*m-h*d*m-u*p*y+a*d*y+h*p*v-a*f*v,e[4]=s*d*y-r*l*y-s*f*v+o*l*v+r*f*x-o*d*x,e[5]=r*l*m-s*d*m+s*p*v-n*l*v-r*p*x+n*d*x,e[6]=s*f*m-o*l*m-s*p*y+n*l*y+o*p*x-n*f*x,e[7]=o*d*m-r*f*m+r*p*y-n*d*y-o*p*v+n*f*v,e[8]=r*c*y-s*u*y+s*h*v-o*c*v-r*h*x+o*u*x,e[9]=s*u*m-r*c*m-s*a*v+n*c*v+r*a*x-n*u*x,e[10]=o*c*m-s*h*m+s*a*y-n*c*y-o*a*x+n*h*x,e[11]=r*h*m-o*u*m-r*a*y+n*u*y+o*a*v-n*h*v,e[12]=s*u*f-r*c*f-s*h*d+o*c*d+r*h*l-o*u*l,e[13]=r*c*p-s*u*p+s*a*d-n*c*d-r*a*l+n*u*l,e[14]=s*h*p-o*c*p-s*a*f+n*c*f+o*a*l-n*h*l,e[15]=o*u*p-r*h*p+r*a*f-n*u*f-o*a*d+n*h*d,this.sdiv(n*e[0]+a*e[4]+p*e[8]+m*e[12]),this},i.prototype.inv=function(){var t=this.elements,e=t[0],i=t[4],n=t[8],o=t[12],r=t[1],s=t[5],a=t[9],h=t[13],u=t[2],c=t[6],p=t[10],f=t[14],d=t[3],l=t[7],m=t[11],y=t[15];return t[0]=a*f*l-h*p*l+h*c*m-s*f*m-a*c*y+s*p*y,t[1]=h*p*d-a*f*d-h*u*m+r*f*m+a*u*y-r*p*y,t[2]=s*f*d-h*c*d+h*u*l-r*f*l-s*u*y+r*c*y,t[3]=a*c*d-s*p*d-a*u*l+r*p*l+s*u*m-r*c*m,t[4]=o*p*l-n*f*l-o*c*m+i*f*m+n*c*y-i*p*y,t[5]=n*f*d-o*p*d+o*u*m-e*f*m-n*u*y+e*p*y,t[6]=o*c*d-i*f*d-o*u*l+e*f*l+i*u*y-e*c*y,t[7]=i*p*d-n*c*d+n*u*l-e*p*l-i*u*m+e*c*m,t[8]=n*h*l-o*a*l+o*s*m-i*h*m-n*s*y+i*a*y,t[9]=o*a*d-n*h*d-o*r*m+e*h*m+n*r*y-e*a*y,t[10]=i*h*d-o*s*d+o*r*l-e*h*l-i*r*y+e*s*y,t[11]=n*s*d-i*a*d-n*r*l+e*a*l+i*r*m-e*s*m,t[12]=o*a*c-n*h*c-o*s*p+i*h*p+n*s*f-i*a*f,t[13]=n*h*u-o*a*u+o*r*p-e*h*p-n*r*f+e*a*f,t[14]=o*s*u-i*h*u-o*r*c+e*h*c+i*r*f-e*s*f,t[15]=i*a*u-n*s*u+n*r*c-e*a*c-i*r*p+e*s*p,this.sdiv(e*t[0]+r*t[4]+u*t[8]+d*t[12]),this},i.prototype.mlerp=function(t,e,i){var n=this.elements,o=t.elements,r=e.elements;return n[0]=h(o[0],r[0],i),n[1]=h(o[1],r[1],i),n[2]=h(o[2],r[2],i),n[3]=h(o[3],r[3],i),n[4]=h(o[4],r[4],i),n[5]=h(o[5],r[5],i),n[6]=h(o[6],r[6],i),n[7]=h(o[7],r[7],i),n[8]=h(o[8],r[8],i),n[9]=h(o[9],r[9],i),n[10]=h(o[10],r[10],i),n[11]=h(o[11],r[11],i),n[12]=h(o[12],r[12],i),n[13]=h(o[13],r[13],i),n[14]=h(o[14],r[14],i),n[15]=h(o[15],r[15],i),this},i.prototype.lerp=function(t,e){var i=this.elements,n=t.elements;return i[0]=h(i[0],n[0],e),i[1]=h(i[1],n[1],e),i[2]=h(i[2],n[2],e),i[3]=h(i[3],n[3],e),i[4]=h(i[4],n[4],e),i[5]=h(i[5],n[5],e),i[6]=h(i[6],n[6],e),i[7]=h(i[7],n[7],e),i[8]=h(i[8],n[8],e),i[9]=h(i[9],n[9],e),i[10]=h(i[10],n[10],e),i[11]=h(i[11],n[11],e),i[12]=h(i[12],n[12],e),i[13]=h(i[13],n[13],e),i[14]=h(i[14],n[14],e),i[15]=h(i[15],n[15],e),this},i.prototype.abs=function(){var t=this.elements;return t[0]=n(t[0]),t[1]=n(t[1]),t[2]=n(t[2]),t[3]=n(t[3]),t[4]=n(t[4]),t[5]=n(t[5]),t[6]=n(t[6]),t[7]=n(t[7]),t[8]=n(t[8]),t[9]=n(t[9]),t[10]=n(t[10]),t[11]=n(t[11]),t[12]=n(t[12]),t[13]=n(t[13]),t[14]=n(t[14]),t[15]=n(t[15]),this},i.prototype.setRotationQuat=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z,r=t.w,s=i+i,a=n+n,h=o+o,u=i*s,c=i*a,p=i*h,f=n*a,d=n*h,l=o*h,m=r*s,y=r*a,v=r*h;return e[0]=1-(f+l),e[4]=c-v,e[8]=p+y,e[1]=c+v,e[5]=1-(u+l),e[9]=d-m,e[2]=p-y,e[6]=d+m,e[10]=1-(u+f),this},i.prototype.setTranslation=function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z||0,this},i.prototype.lookAt=function(){var t=new e(0,0,1),i=new e,n=new e,o=new e;return function(r,s,a){a=a instanceof e?a:t;var h=this.elements;return o.vsub(r,s).norm(),0===o.len()&&(o.z=1),i.vcross(a,o).norm(),0===i.len()&&(o.x+=1e-4,i.vcross(a,o).norm()),n.vcross(o,i),h[0]=i.x,h[4]=n.x,h[8]=o.x,h[1]=i.y,h[5]=n.y,h[9]=o.y,h[2]=i.z,h[6]=n.z,h[10]=o.z,this}}(),i.prototype.extractPosition=function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},i.prototype.extractRotation=function(){var t=new e;return function(e){var i=this.elements,n=e.elements,o=1/t.set(n[0],n[1],n[2]).len(),r=1/t.set(n[4],n[5],n[6]).len(),s=1/t.set(n[8],n[9],n[10]).len();return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[4]=n[4]*r,i[5]=n[5]*r,i[6]=n[6]*r,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,this}}(),i.prototype.translate=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z;return e[12]=e[0]*i+e[4]*n+e[8]*o+e[12],e[13]=e[1]*i+e[5]*n+e[9]*o+e[13],e[14]=e[2]*i+e[6]*n+e[10]*o+e[14],e[15]=e[3]*i+e[7]*n+e[11]*o+e[15],this},i.prototype.rotateAxis=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z;return t.x=i*e[0]+n*e[4]+o*e[8],t.y=i*e[1]+n*e[5]+o*e[9],t.z=i*e[2]+n*e[6]+o*e[10],t.norm(),t},i.prototype.rotateX=function(t){var e=this.elements,i=e[4],n=e[5],s=e[6],a=e[7],h=e[8],u=e[9],c=e[10],p=e[11],f=r(t),d=o(t);return e[4]=f*i+d*h,e[5]=f*n+d*u,e[6]=f*s+d*c,e[7]=f*a+d*p,e[8]=f*h-d*i,e[9]=f*u-d*n,e[10]=f*c-d*s,e[11]=f*p-d*a,this},i.prototype.rotateY=function(t){var e=this.elements,i=e[0],n=e[1],s=e[2],a=e[3],h=e[8],u=e[9],c=e[10],p=e[11],f=r(t),d=o(t);return e[0]=f*i-d*h,e[1]=f*n-d*u,e[2]=f*s-d*c,e[3]=f*a-d*p,e[8]=f*h+d*i,e[9]=f*u+d*n,e[10]=f*c+d*s,e[11]=f*p+d*a,this},i.prototype.rotateZ=function(t){var e=this.elements,i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],u=e[5],c=e[6],p=e[7],f=r(t),d=o(t);return e[0]=f*i+d*h,e[1]=f*n+d*u,e[2]=f*s+d*c,e[3]=f*a+d*p,e[4]=f*h-d*i,e[5]=f*u-d*n,e[6]=f*c-d*s,e[7]=f*p-d*a,this},i.prototype.scale=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z;return e[0]*=i,e[4]*=n,e[8]*=o,e[1]*=i,e[5]*=n,e[9]*=o,e[2]*=i,e[6]*=n,e[10]*=o,e[3]*=i,e[7]*=n,e[11]*=o,this},i.prototype.frustum=function(t,e,i,n,o,r){var s=this.elements,a=2*o/(e-t),h=2*o/(i-n),u=(e+t)/(e-t),c=(i+n)/(i-n),p=-(r+o)/(r-o),f=-2*r*o/(r-o);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=h,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=p,s[14]=f,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},i.prototype.perspective=function(t,e,i,n){var o=i*s(c(.5*t)),r=-o,a=r*e,h=o*e;return this.frustum(a,h,o,r,i,n)},i.prototype.orthographic=function(t,e,i,n,o,r){var s=this.elements,a=1/(e-t),h=1/(i-n),u=1/(r-o),c=(e+t)*a,p=(i+n)*h,f=(r+o)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*h,s[9]=0,s[13]=-p,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-f,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},i.prototype.toString=function(){var t=this.elements;return"Mat4["+t[0]+", "+t[4]+", "+t[8]+", "+t[12]+"]\n"+"     ["+t[1]+", "+t[5]+", "+t[9]+", "+t[13]+"]\n"+"     ["+t[2]+", "+t[6]+", "+t[10]+", "+t[14]+"]\n"+"     ["+t[3]+", "+t[7]+", "+t[11]+", "+t[15]+"]"},i.prototype.equals=function(t){var e=this.elements,i=t.elements;return!!(u(e[0],i[0])&&u(e[1],i[1])&&u(e[2],i[2])&&u(e[3],i[3])&&u(e[4],i[4])&&u(e[5],i[5])&&u(e[6],i[6])&&u(e[7],i[7])&&u(e[8],i[8])&&u(e[9],i[9])&&u(e[10],i[10])&&u(e[11],i[11])&&u(e[12],i[12])&&u(e[13],i[13])&&u(e[14],i[14])&&u(e[15],i[15]))},i.equals=function(t,e){var i=t.elements,n=e.elements;return!!(u(i[0],n[0])&&u(i[1],n[1])&&u(i[2],n[2])&&u(i[3],n[3])&&u(i[4],n[4])&&u(i[5],n[5])&&u(i[6],n[6])&&u(i[7],n[7])&&u(i[8],n[8])&&u(i[9],n[9])&&u(i[10],n[10])&&u(i[11],n[11])&&u(i[12],n[12])&&u(i[13],n[13])&&u(i[14],n[14])&&u(i[15],n[15]))},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/quat",["math/mathf","math/vec3"],function(t,e){function i(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||1,t&&t.x?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.w=t.w||1):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||1)}var n=Math.abs,o=Math.sqrt,r=Math.acos,s=Math.sin,a=Math.cos,h=t.lerp,u=t.clamp,c=t.equals;return i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.qmul=function(t,e){var i=t.x,n=t.y,o=t.z,r=t.w,s=e.x,a=e.y,h=e.z,u=e.w;return this.x=i*u+r*s+n*h-o*a,this.y=n*u+r*a+o*s-i*h,this.z=o*u+r*h+i*a-n*s,this.w=r*u-i*s-n*a-o*h,this},i.prototype.mul=function(t){var e=this.x,i=this.y,n=this.z,o=this.w,r=t.x,s=t.y,a=t.z,h=t.w;return this.x=e*h+o*r+i*a-n*s,this.y=i*h+o*s+n*r-e*a,this.z=n*h+o*a+e*s-i*r,this.w=o*h-e*r-i*s-n*a,this},i.prototype.smul=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.sdiv=function(t){return t=0!==t?1/t:0,this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.qdot=i.prototype.qdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.prototype.qlerp=function(t,e,i){return this.x=h(t.x,e.x,i),this.y=h(t.y,e.y,i),this.z=h(t.z,e.z,i),this.w=h(t.w,e.w,i),this},i.prototype.lerp=function(t,e){return this.x=h(this.x,t.x,e),this.y=h(this.y,t.y,e),this.z=h(this.z,t.z,e),this.w=h(this.w,t.w,e),this},i.prototype.qslerp=function(){var t=new i,e=new i,n=new i,o=new i;return function(i,h,c){var p=u(i.dot(h),-1,1),f=r(p)*c;return t.copy(i),e.copy(h),n.copy(t),o.vsub(e,n.smul(p)),o.norm(),this.vadd(t.smul(a(f)),o.smul(s(f)))}}(),i.prototype.slerp=function(){var t=new i,e=new i,n=new i,o=new i;return function(i,h){var c=u(this.dot(i),-1,1),p=r(c)*h;return t.copy(this),e.copy(i),n.copy(t),o.vsub(e,n.smul(c)),o.norm(),this.vadd(t.smul(a(p)),o.smul(s(p)))}}(),i.prototype.lenSq=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return t*t+e*e+i*i+n*n},i.prototype.len=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return o(t*t+e*e+i*i+n*n)},i.prototype.norm=function(){var t=this.x,e=this.y,i=this.z,n=this.w,r=t*t+e*e+i*i+n*n;return r=0!==r?1/o(r):0,this.x*=r,this.y*=r,this.z*=r,this.w*=r,this},i.prototype.qinv=function(t){var e=t.x,i=t.y,n=t.z,r=t.w,s=e*e+i*i+n*n+r*r;return s=0!==s?1/o(s):0,this.x=-e*s,this.y=-i*s,this.z=-n*s,this.w=r*s,this},i.prototype.inv=function(){var t=this.x,e=this.y,i=this.z,n=this.w,r=t*t+e*e+i*i+n*n;return r=0!==r?1/o(r):0,this.x=-t*r,this.y=-e*r,this.z=-i*r,this.w=n*r,this},i.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.calculateW=function(){var t=this.x,e=this.y,i=this.z;return this.w=-o(n(1-t*t-e*e-i*i)),this},i.prototype.axisAngle=function(t,e){var i=.5*e,n=s(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=a(i),this},i.prototype.setVec3s=function(){var t=new e;return function(e,i){return t.vcross(e,i),this.x=t.x,this.y=t.y,this.z=t.z,this.w=o(e.lenSq()*i.lenSq())+e.dot(i),this.norm(),this}}(),i.prototype.setRotationMat3=function(t){var e,i=t.elements,n=i[0],r=i[3],s=i[6],a=i[1],h=i[4],u=i[7],c=i[2],p=i[5],f=i[8],d=n+h+f;return d>0?(e=.5/o(d+1),this.w=.25/e,this.x=(p-u)*e,this.y=(s-c)*e,this.z=(a-r)*e):n>h&&n>f?(e=2*o(1+n-h-f),this.w=(p-u)/e,this.x=.25*e,this.y=(r+a)/e,this.z=(s+c)/e):h>f?(e=2*o(1+h-n-f),this.w=(s-c)/e,this.x=(r+a)/e,this.y=.25*e,this.z=(u+p)/e):(e=2*o(1+f-n-h),this.w=(a-r)/e,this.x=(s+c)/e,this.y=(u+p)/e,this.z=.25*e),this},i.prototype.setRotationMat4=function(t){var e,i=t.elements,n=i[0],r=i[4],s=i[8],a=i[1],h=i[5],u=i[9],c=i[2],p=i[6],f=i[10],d=n+h+f;return d>0?(e=.5/o(d+1),this.w=.25/e,this.x=(p-u)*e,this.y=(s-c)*e,this.z=(a-r)*e):n>h&&n>f?(e=2*o(1+n-h-f),this.w=(p-u)/e,this.x=.25*e,this.y=(r+a)/e,this.z=(s+c)/e):h>f?(e=2*o(1+h-n-f),this.w=(s-c)/e,this.x=(r+a)/e,this.y=.25*e,this.z=(u+p)/e):(e=2*o(1+f-n-h),this.w=(a-r)/e,this.x=(s+c)/e,this.y=(u+p)/e,this.z=.25*e),this},i.prototype.rotateX=function(t){var e=.5*t,i=this.x,n=this.y,o=this.z,r=this.w,h=s(e),u=a(e);return this.x=i*u+r*h,this.y=n*u+o*h,this.z=o*u-n*h,this.w=r*u-i*h,this},i.prototype.rotateY=function(t){var e=.5*t,i=this.x,n=this.y,o=this.z,r=this.w,h=s(e),u=a(e);return this.x=i*u-o*h,this.y=n*u+r*h,this.z=o*u+i*h,this.w=r*u-n*h,this},i.prototype.rotateZ=function(t){var e=.5*t,i=this.x,n=this.y,o=this.z,r=this.w,h=s(e),u=a(e);return this.x=i*u+n*h,this.y=n*u-i*h,this.z=o*u+r*h,this.w=r*u-o*h,this},i.prototype.rotate=function(t,e,i){return this.rotateZ(i),this.rotateX(t),this.rotateY(e),this},i.prototype.toString=function(){return"Quat( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},i.prototype.equals=function(t){return!!(c(this.x,t.x)&&c(this.y,t.y)&&c(this.z,t.z)&&c(this.w,t.w))},i.equals=function(t,e){return!!(c(t.x,e.x)&&c(t.y,e.y)&&c(t.z,e.z)&&c(t.w,e.w))},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("math/vec4",["math/mathf"],function(t){function e(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||1,t&&t.x?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.w=t.w||1):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||1)}var i=Math.abs,n=Math.sqrt,o=Math.acos,r=Math.sin,s=Math.cos,a=t.lerp,h=t.clamp,u=t.equals;return e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},e.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},e.prototype.sadd=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},e.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},e.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},e.prototype.ssub=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},e.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this},e.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},e.prototype.smul=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.prototype.vdiv=function(t,e){var i=e.x,n=e.y,o=e.z,r=e.w;return this.x=0!==i?t.x/i:0,this.y=0!==n?t.y/n:0,this.z=0!==o?t.z/o:0,this.w=0!==r?t.w/r:0,this},e.prototype.div=function(t){var e=t.x,i=t.y,n=t.z,o=t.w;return this.x=0!==e?this.x/e:0,this.y=0!==i?this.y/i:0,this.z=0!==n?this.z/n:0,this.w=0!==o?this.w/o:0,this
},e.prototype.sdiv=function(t){return t=0!==t?1/t:0,this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.vdot=e.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.prototype.vlerp=function(t,e,i){return this.x=a(t.x,e.x,i),this.y=a(t.y,e.y,i),this.z=a(t.z,e.z,i),this.w=a(t.w,e.w,i),this},e.prototype.lerp=function(t,e){return this.x=a(this.x,t.x,e),this.y=a(this.y,t.y,e),this.z=a(this.z,t.z,e),this.w=a(this.w,t.w,e),this},e.prototype.vslerp=function(){var t=new e,i=new e,n=new e,a=new e;return function(e,u,c){var p=h(e.dot(u),-1,1),f=o(p)*c;return t.copy(e),i.copy(u),n.copy(t),a.vsub(i,n.smul(p)),a.norm(),this.vadd(t.smul(s(f)),a.smul(r(f)))}}(),e.prototype.slerp=function(){var t=new e,i=new e,n=new e,a=new e;return function(e,u){var c=h(this.dot(e),-1,1),p=o(c)*u;return t.copy(this),i.copy(e),n.copy(t),a.vsub(i,n.smul(c)),a.norm(),this.vadd(t.smul(s(p)),a.smul(r(p)))}}(),e.prototype.applyMat4=function(t){var e=t.elements,i=this.x,n=this.y,o=this.z,r=this.w;return this.x=i*e[0]+n*e[4]+o*e[8]+r*e[12],this.y=i*e[1]+n*e[5]+o*e[9]+r*e[13],this.z=i*e[2]+n*e[6]+o*e[10]+r*e[14],this.w=i*e[3]+n*e[7]+o*e[11]+r*e[15],this},e.prototype.applyProj=function(t){var e=t.elements,i=this.x,n=this.y,o=this.z,r=this.w;return d=1/(i*e[3]+n*e[7]+o*e[11]+r*e[15]),this.x=(e[0]*i+e[4]*n+e[8]+o*e[12])*d,this.y=(e[1]*i+e[5]*n+e[9]+o*e[13])*d,this.z=(e[2]*i+e[6]*n+e[10]+o*e[14])*d,this.z=(e[3]*i+e[7]*n+e[11]+o*e[15])*d,this},e.prototype.lenSq=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return t*t+e*e+i*i+n*n},e.prototype.len=function(){var t=this.x,e=this.y,i=this.z,o=this.w;return n(t*t+e*e+i*i+o*o)},e.prototype.norm=function(){var t=this.x,e=this.y,i=this.z,o=this.w,r=t*t+e*e+i*i+o*o;return r=0!==r?1/n(r):0,this.x*=r,this.y*=r,this.z*=r,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},e.prototype.abs=function(){return this.x=i(this.x),this.y=i(this.y),this.z=i(this.z),this.w=i(this.w),this},e.prototype.min=function(t){var e=t.x,i=t.y,n=t.z,o=t.w;return this.x=this.x>e?e:this.x,this.y=this.y>i?i:this.y,this.z=this.z>n?n:this.z,this.w=this.w>o?o:this.w,this},e.prototype.max=function(t){var e=t.x,i=t.y,n=t.z,o=t.w;return this.x=e>this.x?e:this.x,this.y=i>this.y?i:this.y,this.z=n>this.z?n:this.z,this.w=o>this.w?o:this.w,this},e.prototype.clamp=function(t,e){return this.x=h(this.x,t.x,e.x),this.y=h(this.y,t.y,e.y),this.z=h(this.z,t.z,e.z),this.w=h(this.w,t.w,e.w),this},e.prototype.toString=function(){return"Vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},e.prototype.equals=function(t,e){return!!(u(this.x,t.x,e)&&u(this.y,t.y,e)&&u(this.z,t.z,e)&&u(this.w,t.w,e))},e.equals=function(t,e,i){return!!(u(t.x,e.x,i)&&u(t.y,e.y,i)&&u(t.z,e.z,i)&&u(t.w,e.w,i))},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/game/config",[],function(){function t(){this.debug=!1,this.forceCanvas=!1,this.host="127.0.0.1",this.port=3e3}return new t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/assets/assets",["base/class","base/time","core/game/config"],function(t,e,i){function n(e){e||(e={}),t.call(this),this.total=0,this.loadTime=0,this.loaded=0,this.loading=!1,this.assets={}}var o=e.now;return t.extend(n,t),n.prototype.addAssets=function(){for(var t=arguments.length;t--;)this.addAsset(arguments[t])},n.prototype.addAsset=function(t){if(!t)return console.warn(this+".addAsset: Asset is not defined"),void 0;var e=t.name,i=this.assets,n=i[e];n?console.warn(this+".addAsset: already has an asset with name "+t.name):(this.total++,i[e]=t)},n.prototype.add=n.prototype.addAssets,n.prototype.removeAssets=function(){for(var t=arguments.length;t--;)this.removeAsset(arguments[t])},n.prototype.removeAsset=function(t){if(!t)return console.warn(this+".removeAsset: Asset is not defined"),void 0;var e=t.name,i=this.assets,n=i[e];n?(this.total--,i[e]=void 0):console.warn(this+".removeAsset: Assets does not have asset "+t)},n.prototype.remove=n.prototype.removeAssets,n.prototype.load=function(t){var e,n,r=this,s=this.assets,a=o();r.trigger("load"),this.loading=!0;for(n in s)e=s[n],e&&e.src?e.load(function(e){i.debug&&console.log("Assets.load: loading "+e.name+" from "+e.src),r.loaded++,r.loaded>=r.total&&(r.loadTime=o()-a,i.debug&&console.log("Assets.load: "+r.loaded+" in "+r.loadTime+"s"),r.loading=!1,t&&t(),r.trigger("loaded"))}):(r.loaded++,r.loaded>=r.total&&(r.loadTime=o()-a,i.debug&&console.log("Assets.load: "+r.loaded+" in "+r.loadTime+"s"),r.loading=!1,t&&t(),r.trigger("loaded")))},n.prototype.get=function(t){var e=this.assets[t];return e||console.warn(this+".get: Assets has no assets named "+t),e},new n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/assets/asset",["base/class","core/assets/assets"],function(t){function e(e){e||(e={}),t.call(this),this.name=void 0!==e.name?e.name:this._class+this._id,this.src=void 0!==e.src?e.src:"",this.data=void 0,this.glData=void 0}return t.extend(e,t),e.prototype.load=function(){},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/assets/imageasset",["base/class","core/assets/asset"],function(t,e){function i(t){t||(t={}),e.call(this,t),this.glData={needsUpdate:!0,texture:void 0}}return t.extend(i,e),i.prototype.load=function(t){var e=this,i=new Image;this.data=void 0,i.onload=function(){e.data=i,e.trigger("loaded"),t&&t(e)},i.src=this.src},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/assets/spritesheetasset",["base/class","base/dom","core/assets/asset"],function(t,e,i){function n(t){t||(t={}),i.call(this,t)}var o=e.ajax;return t.extend(n,i),n.prototype.load=function(t){var e=this;o(this.src,function(i){var n=JSON.parse(i);e.data=n,t&&t(e)})},n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/components/component",["base/class"],function(t){function e(){t.call(this),this.gameObject=void 0}return t.extend(e,t),e.prototype.init=function(){},e.prototype.update=function(){},e.prototype.destroy=function(){var t=this.gameObject;t?t.removeComponent(this):console.warn(this+".destroy: Component is not added to a GameObject"),this.trigger("destroy")},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/components/camera2d",["base/class","math/mathf","math/mat32","math/mat4","core/components/component"],function(t,e,i,n,o){function r(t){t||(t={}),o.call(this),this.clientWidth=1920,this.clientHeight=1080,this._zoom=void 0!==t.zoom?t.zoom:1,this._width=this.clientWidth,this._height=this.clientHeight,this._aspect=this._width/this._height,this.matrixProj=new i,this.matrixProj4=new n,this.matrixProjInv=new i,this.matrixWorldInv=new i,this.matrixViewProj=new i,this.matrixViewProjInv=new i,this.needsUpdate=!0}var s=e.EPSILON;return t.extend(r,o),t.props(r.prototype,{zoom:{get:function(){return this._zoom},set:function(t){this._zoom=s>t?s:t,this.needsUpdate=!0}},width:{get:function(){return this._width},set:function(t){this._width=t,this._aspect=t/this._height,this.needsUpdate=!0}},height:{get:function(){return this._height},set:function(t){this._height=t,this._aspect=this._width/t,this.needsUpdate=!0}},aspect:{get:function(){return this._aspect}}}),r.prototype.toWorld=function(t){t.x=2*t.x/this.clientWidth-1,t.y=2*t.y/this.clientHeight-1,t.applyMat32(this.matrixViewProjInv)},r.prototype.toScreen=function(t){t.applyMat32(this.matrixViewProj),t.x=(t.x+1)/2*this.clientWidth,t.y=(t.y+1)/2*this.clientHeight},r.prototype.init=function(){this.update()},r.prototype.update=function(){var t=this.gameObject,e=t.transform2d,i=e.matrixWorld,n=this.matrixProj,o=this.matrixProjInv;if(this.needsUpdate){var r=this.zoom,s=.5*this.width*r,a=-s,h=.5*this.height*r,u=-h;n.orthographic(a,s,h,u),o.minv(n),this.matrixProj4.orthographic(a,s,h,u,-1,1),this.needsUpdate=!1}e&&(this.matrixWorldInv.minv(i),this.matrixViewProj.mmul(this.matrixWorldInv,n),this.matrixViewProjInv.minv(this.matrixViewProj))},r}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/components/particle2d",["base/class","math/color","math/vec2"],function(t,e,i){function n(){t.call(this),this.life=3,this.size=.25,this.position=new i,this.rotation=0,this.velocity=new i,this.angularVelocity=0,this.time=0,this.alive=!0}return t.extend(n,t),n.prototype.update=function(t){var e=this.position,i=this.velocity;this.time+=t,this.time>=this.life&&(this.alive=!1),e.x+=i.x*t,e.y+=i.y*t,this.rotation+=this.angularVelocity*t},n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/components/emitter2d",["base/class","base/objectpool","math/mathf","math/color","math/vec2","core/components/component","core/components/particle2d"],function(t,e,i,n,o,r,s){function a(t){t||(t={}),r.call(this),this.emit=void 0!==t.emit?!!t.emit:!0,this.minSize=void 0!==t.minSize?t.minSize:1,this.maxSize=void 0!==t.maxSize?t.maxSize:1,this.minEnergy=void 0!==t.minEnergy?t.minEnergy:1,this.maxEnergy=void 0!==t.maxEnergy?t.maxEnergy:1,this.minEmission=void 0!==t.minEmission?t.minEmission:1,this.maxEmission=void 0!==t.maxEmission?t.maxEmission:1,this.velocity=void 0!==t.velocity?t.velocity:new o,this.randVelocity=void 0!==t.randVelocity?t.randVelocity:new o,this.randAngularVelocity=void 0!==t.randAngularVelocity?t.randAngularVelocity:0,this.angularVelocity=void 0!==t.angularVelocity?t.angularVelocity:0,this.particles=[]}var h=new e(s),u=i.randInt,c=Math.random;return t.extend(a,r),a.prototype.init=function(){var t,e,i=this.gameObject,n=i.transform2d,o=this.velocity,r=this.randVelocity,s=u(this.minEmission,this.maxEmission),a=this.particles;if(n&&!this.emit)for(;s--;)t=h.create(),e=t.velocity,t.time=0,t.alive=!0,t.life=u(this.minEnergy,this.maxEnergy),t.position.set(0,0),t.rotation=0,e.x=o.x+r.x*c(),e.y=o.y+r.y*c(),t.angularVelocity=this.angularVelocity+c()*this.randAngularVelocity,a.push(t)},a.prototype.update=function(){var t,e,i,n=this.gameObject,o=n.transform2d,r=this.velocity,s=this.randVelocity,a=u(this.minEmission,this.maxEmission),p=this.particles;if(o){if(this.emit)for(;a--;)t=h.create(),e=t.velocity,t.time=0,t.alive=!0,t.life=u(this.minEnergy,this.maxEnergy),t.position.set(0,0),t.rotation=0,e.x=r.x+s.x*c(),e.y=r.y+s.y*c(),t.angularVelocity=this.angularVelocity+c()*this.randAngularVelocity,p.push(t);for(i=p.length;i--;)t=p[i],t.update(Time.delta),t.alive||(p.splice(i,1),h.remove(t))}},a}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/components/rigidbody2d",["base/class","base/time","math/vec2","core/components/component"],function(t,e,i,n){function o(t){t||(t={}),n.call(this),this.body=new PRigidBody2D(t)}return t.extend(o,n),o.prototype.init=function(){var t,e=this.body,i=e.shapes,n=this.gameObject,o=n.transform2d||n.transform3d,r=e.position,s=o.position,a=o.rotation;for(r.x=s.x,r.y=s.y,e.rotation=a,t=i.length;t--;)i[t].calculateAABB()},o.prototype.update=function(){var t=this.body,e=this.gameObject,i=e.transform2d||e.transform3d,n=t.position,o=t.rotation,r=i.position;r.x=n.x,r.y=n.y,i.rotation=o},o}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/components/sprite2d",["base/class","base/time","math/vec2","core/components/component"],function(t,e,i,n){function o(t){t||(t={}),n.call(this),this.visible=void 0!==t.visible?!!t.visible:!0,this.z=void 0!==t.z?t.z:0,this.alpha=void 0!==t.alpha?t.alpha:1,this.image=void 0!==t.image?t.image:void 0,this.width=t.width||1,this.height=t.height||1,this.x=t.x||0,this.y=t.y||0,this.w=t.w||64,this.h=t.h||64,t.animations&&t.animations.data&&(t.animations=t.animations.data),this.animations=t.animations||{idle:[[this.x,this.y,this.w,this.h,.25]]},this.animation="idle",this.mode=void 0!==t.mode?t.mode:o.LOOP,this.rate=void 0!==t.rate?t.rate:1,this._time=0,this._frame=0,this._order=1,this.playing=void 0!==this.animations[this.animation]?!0:!1}return t.extend(o,n),o.prototype.copy=function(t){return t.animations,this.z=t.z,this.image=t.image,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this.animations=t.animations,this.animation=t.animation,this.mode=t.mode,this.rate=t.rate,this._time=t._time,this._frame=t._frame,this._order=t._order,this.playing=t.playing,this},o.prototype.play=function(t,e,i){if((!this.playing||this.animation!==t)&&this.animations[t]){switch(this.animation=t,this.rate=i||this.rate,this.mode===o.ONCE&&(this._frame=0),e){case o.LOOP:case"loop":this.mode=o.LOOP;break;case o.PINGPONG:case"pingpong":this.mode=o.PINGPONG;break;case o.ONCE:case"once":this.mode=o.ONCE,this._frame=0;break;default:this.mode=o.LOOP}this.playing=!0,this.trigger("play",t)}},o.prototype.stop=function(){this.playing&&this.trigger("stop"),this.playing=!1},o.prototype.update=function(){var t,i=this.animations[this.animation],n=this._frame,r=i.length-1,s=this._order,a=this.mode,t=i[n],h=t[4];this.playing&&(this._time+=e.delta*this.rate,this._time>=h&&(this._time=0,t&&(this.x=t[0],this.y=t[1],this.w=t[2],this.h=t[3]),a===o.PINGPONG?1===s?n>=r?this._order=-1:this._frame++:0>=n?this._order=1:this._frame--:n>=r?a===o.LOOP?this._frame=0:a===o.ONCE&&this.stop():this._frame++))},o.ONCE=0,o.LOOP=1,o.PINGPONG=2,o}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/components/transform2d",["base/class","math/mathf","math/vec2","math/mat32","core/components/component"],function(t,e,n,o,r){function s(t){t||(t={}),r.call(this),this.root=this,this.children=[],this.matrix=new o,this.matrixWorld=new o,this.position=void 0!==t.position?t.position:new n,this.scale=void 0!==t.scale?t.scale:new n(1,1),this.rotation=void 0!==t.rotation?t.rotation:0,t.children&&this.addChild.apply(this,t.children)}var a=e.EPSILON;return t.extend(s,r),s.prototype.init=function(){this.update()},s.prototype.update=function(){var t=this.scale,e=this.matrix,i=this.matrixWorld;e.setRotation(this.rotation),(1!==t.x||1!==t.y)&&e.scale(t),e.setTranslation(this.position),this.root===this?i.copy(e):i.mmul(this.parent.matrixWorld,e)},s.prototype.toWorld=function(t){return t.applyMat32(this.matrixWorld)},s.prototype.toLocal=function(){var t=new o;return function(e){return e.applyMat32(t.minv(this.matrixWorld))}}(),s.prototype.translate=function(){var t=new n;return function(e,i){t.copy(e),i instanceof s?t.rotate(i.rotation):i instanceof Number&&t.rotate(i),this.position.add(t)}}(),s.prototype.rotate=function(){var t=new n;return function(e,i){t.copy(e),i instanceof s?t.rotate(i.rotation):i instanceof Number&&t.rotate(i),this.rotation.rotate(t.x,t.y,t.z)}}(),s.prototype.scale=function(){var t=new n;return function(e,i){t.copy(e),i instanceof s?t.rotate(i.rotation):i instanceof Number&&t.rotate(i),this.scale.mul(t)}}(),s.prototype.lookAt=function(){var t=new n,e=new o;return function(i,o){o=o instanceof n?o:void 0,i instanceof s?t.copy(i.position):i instanceof n&&t.copy(i),e.lookAt(this.position,t,o),this.rotation.setRotationMat32(e)}}(),s.prototype.follow=function(){var t=new n;return function(e,i,o){i=i>0?i:1,e instanceof s?t.sub(e.position,this.position):e instanceof n&&t.sub(e,this.position),t.lenSq()>a&&this.translate(t.smul(1/i),o)}}(),s.prototype.addChildren=function(){for(i=arguments.length;i--;)this.addChild(arguments[i])},s.prototype.addChild=function(t){if(!t)return console.warn(this+".addTransform2D: Transform2D is not defined"),void 0;var e,i=this.children,n=i.indexOf(t);if(0>n){for(t.parent&&t.parent.remove(t),t.parent=this,i.push(t),e=this;e.parent;)e=e.parent;t.root=e}else console.warn(this+".addTransform2D: Transform2D already has child "+t)},s.prototype.add=s.prototype.addChildren,s.prototype.removeChildren=function(){for(i=arguments.length;i--;)this.removeChildren(arguments[i])},s.prototype.removeChild=function(t){if(!t)return console.warn(this+".removeTransform2D: Transform2D is not defined"),void 0;var e,i=this.children,n=i.indexOf(t);if(n>-1){for(t.parent=void 0,i.splice(n,1),e=this;e.parent;)e=e.parent;t.root=e}else console.warn(this+".removeTransform2D: Transform2D does not have child "+t)},s.prototype.remove=s.prototype.removeChildren,s}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/canvas",["base/class","base/device","base/dom"],function(t,e,i){function n(e,i){t.call(this),this.viewportId="viewport"+this._id,o(this.viewportId,"viewport","initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"),o(this.viewportId+"-width","viewport","width=device-width"),o(this.viewportId+"-height","viewport","height=device-height");var n=document.createElement("canvas");this.element=n,this.fullScreen=!1,this.width=960,this.height=640,e||i?(this.width=void 0!==e?e:960,this.height=void 0!==i?i:640):(this.fullScreen=!0,this.width=window.innerWidth,this.height=window.innerHeight,this._aspect=window.innerWidth/window.innerHeight),this._width=this.width,this._height=this.height,this._aspect=this._width/this._height,n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.padding="0px",n.style.margin="0px",n.marginLeft=.5*-this.width+"px",n.marginTop=.5*-this.height+"px",n.style.width=Math.floor(this.width)+"px",n.style.height=Math.floor(this.height)+"px",n.width=this.width,n.height=this.height,this.aspect=this.width/this.height,n.oncontextmenu=function(){return!1},document.body.appendChild(n),this.handleResize(),r(top,"resize orientationchange",this.handleResize,this)}var o=i.addMeta,r=i.addEvent;return t.extend(n,t),n.prototype.set=function(t,e){return t&&e?(t=t,e=e,this.width=t,this.height=e,this.aspect=this.width/this.height,this.handleResize(),void 0):(console.warn("Canvas.set: no width and or height specified using default width and height"),void 0)},n.prototype.handleResize=function(){var t,i,n=this.element,o=n.style,r=window.innerWidth,s=window.innerHeight,a=e.pixelRatio,h=1/a,u=r/s,c="#"+this.viewportId,p=document.querySelector(c).getAttribute("content");this.fullScreen?(this.aspect=r/s,this.aspect>=this._aspect?(this.width=n.width=this._height*this.aspect,this.height=n.height=this._height):(this.width=n.width=this._width,this.height=n.height=this._width/this.aspect),t=r,i=s):u>=this.aspect?(t=s*this.aspect,i=s):(t=r,i=r/this.aspect),t*=h,i*=h,o.width=Math.floor(t)+"px",o.height=Math.floor(i)+"px",o.marginLeft=.5*-t+"px",o.marginTop=.5*-i+"px",document.querySelector(c).setAttribute("content",p.replace(/-scale\s*=\s*[.0-9]+/g,"-scale="+a)),document.querySelector(c+"-width").setAttribute("content","width="+r),document.querySelector(c+"-height").setAttribute("content","height="+s),window.scrollTo(1,1),this.trigger("resize")},n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/renderers/canvasrenderer2d",["base/class","base/dom","base/device","base/time","core/canvas","math/color","math/mat32"],function(t,e,i,n,o,r,s){function a(e){e||(e={}),t.call(this),this.pixelRatio=(void 0!==e.pixelRatio?e.pixelRatio:128)*i.pixelRatio,this.canvas=e.canvas instanceof o?e.canvas:new o(e.width,e.height),this.context=this.canvas.element.getContext("2d"),this.autoClear=void 0!==e.autoClear?e.autoClear:!0,this._data={images:{"default":c}}}var h=(n.now,Math.PI),u=2*h,c=new Image;return c.src="data:image/gif;base64,R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",t.extend(a,t),a.prototype.setClearColor=function(t){this.canvas.element.style.background=t?t.hex():"#000000"},a.prototype.clear=function(){this.context.clearRect(-1,-1,2,2)},a.prototype.render=function(){var t,e,i=new r;return function(n,o){var r,s,a=this,h=n.world.background,u=this.context,c=n.components,p=(c.Circle2D,c.Poly2D,c.Rect2D);if(c.Sprite2D,c.Renderable2D,i.equals(h)||(this.setClearColor(h),i.copy(h)),t!==n&&(this.setClearColor(h),t=n),e!==o){var f=this.canvas,d=1/this.pixelRatio,l=(f.width*d,f.height*d,.5*f.width),m=.5*f.height;u.translate(l,m),u.scale(l,m),o.width=l,o.height=m,o.clientWidth=window.innerWidth,o.clientHeight=window.innerHeight,f.fullScreen&&(f.off("resize"),f.on("resize",function(){var t=1/a.pixelRatio,e=this.width*t,i=this.height*t,n=.5*this.width,r=.5*this.height;u.translate(n,r),u.scale(n,r),o.width=e,o.height=i,o.clientWidth=window.innerWidth,o.clientHeight=window.innerHeight})),e=o}if(this.autoClear&&this.clear(),p)for(s=p.length;s--;)r=p[s],r.visible&&this.renderComponent(r,o)}}(),a.prototype.renderComponent=function(){var t=new s,e=new s,i=new s,n=i.elements;return function(o,r){var s,a,h,c,p,f=this.context,d=this._data.images,l=o.gameObject,m=l.transform2d,y=o.offset,v=o.image,x=o.radius,g=o.extents,w=o.vertices,b=o.body,z=d[v];if(!z&&v&&("default"===v?z=d["default"]:(z=new Image,z.src=v,d[v]=z)),t.copy(m.matrixWorld),e.mmul(t,r.matrixWorldInverse),i.mmul(e,r.matrix),f.save(),f.transform(n[0],-n[2],-n[1],n[3],n[4],n[5]),f.scale(1,-1),o.image&&f.drawImage(z,o.x,o.y,o.w,o.h,y.x-.5*o.width,o.height*-.5-y.y,o.width,o.height),x||g||w){if(b&&(s=b.sleepState),o.fill&&(f.fillStyle=o.color?o.color.rgba():"#000000"),f.globalAlpha=o.alpha,3===s&&(f.globalAlpha*=.5),o.line&&(f.strokeStyle=o.lineColor?o.lineColor.rgba():"#000000",f.lineWidth=o.lineWidth||1/this.pixelRatio),f.beginPath(),x)o.body&&f.lineTo(0,0),f.arc(y.x,-y.y,x,0,u);else if(g)h=y.x+g.x,c=g.y-y.y,f.lineTo(h,c),f.lineTo(-h,c),f.lineTo(-h,-c),f.lineTo(h,-c);else if(w)for(p=w.length;p--;)a=w[p],f.lineTo(y.x+a.x,a.y-y.y);f.closePath(),o.fill&&f.fill(),o.line&&(f.globalAlpha=1,f.stroke())}f.restore()}}(),a}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/renderers/webglrenderer2d",["base/class","base/dom","base/device","core/canvas","math/mathf","math/color","math/vec2","math/mat32","math/mat4","core/components/sprite2d"],function(t,e,i,n,o,r,s,a,h,u){function c(t,e){var i,n,o,r,s,a,h,u=e.vertexShader+e.fragmentShader,c=u.split("\n");for(a=c.length;a--;)if(s=c[a],i=s.match(g),n=s.match(w),i&&(o=i[3],e.attributes[o]=t.getAttribLocation(e.program,o)),n)if(o=n[3],r=parseInt(n[5]))for(e.uniforms[o]=[],h=r;h--;)e.uniforms[o][h]=t.getUniformLocation(e.program,o+"["+h+"]");else e.uniforms[o]=t.getUniformLocation(e.program,o)}function p(t,e){if(e.glData.needsUpdate){var i=t.context,n=(t.gpu,t.ext,e.glData),o=e.data,r=i.createTexture(),s=x(o.width)&&x(o.height),a=i.TEXTURE_2D,h=i.LINEAR,u=s?i.LINEAR_MIPMAP_NEAREST:i.LINEAR,c=s?i.REPEAT:i.CLAMP_TO_EDGE,p=i.RGBA;i.bindTexture(a,r),i.texImage2D(a,0,p,p,i.UNSIGNED_BYTE,o),i.texParameteri(a,i.TEXTURE_MAG_FILTER,h),i.texParameteri(a,i.TEXTURE_MIN_FILTER,u),i.texParameteri(a,i.TEXTURE_WRAP_S,c),i.texParameteri(a,i.TEXTURE_WRAP_T,c),s&&i.generateMipmap(a),i.bindTexture(a,null),n.texture=r,n.needsUpdate=!1}}function f(t){return["precision "+t+" float;","uniform mat4 uMatrix;","uniform vec2 uPosition;","uniform float uSize;","void main(){","gl_PointSize = uSize;","gl_Position = uMatrix * vec4( uPosition, 0.0, 1.0 );","}"].join("\n")}function d(t){return["precision "+t+" float;","uniform float uAlpha;","uniform vec3 uColor;","void main(){","gl_FragColor = vec4( uColor, uAlpha );","}"].join("\n")}function l(t){return["precision "+t+" float;","uniform mat4 uMatrix;","uniform vec4 uCrop;","uniform vec2 uScale;","attribute vec2 aVertexPosition;","attribute vec2 aVertexUv;","varying vec2 vVertexUv;","void main(){","vVertexUv = vec2( aVertexUv.x * uCrop.z, aVertexUv.y * uCrop.w ) + uCrop.xy;","gl_Position = uMatrix * vec4( aVertexPosition * uScale, 0.0, 1.0 );","}"].join("\n")}function m(t){return["precision "+t+" float;","uniform float uAlpha;","uniform sampler2D uTexture;","varying vec2 vVertexUv;","void main(){","vec4 finalColor = texture2D( uTexture, vVertexUv );","finalColor.w *= uAlpha;","gl_FragColor = finalColor;","}"].join("\n")}function y(o){o||(o={}),t.call(this),this.pixelRatio=(void 0!==o.pixelRatio?o.pixelRatio:128)*i.pixelRatio,this.canvas=o.canvas instanceof n?o.canvas:new n(o.width,o.height),o.attributes||(o.attributes={}),o.attributes.depth=!1,this.context=e.getWebGLContext(this.canvas.element,o.attributes),this.autoClear=void 0!==o.autoClear?o.autoClear:!0,this.ext={texture_filter_anisotropic:void 0,texture_float:void 0,standard_derivatives:void 0,compressed_texture_s3tc:void 0},this.gpu={precision:"highp",maxAnisotropy:16,maxTextures:16,maxTextureSize:16384,maxCubeTextureSize:16384,maxRenderBufferSize:16384},this.glData={sprite:{vertexBuffer:void 0,indexBuffer:void 0,uvBuffer:void 0,vertexShader:void 0,fragmentShader:void 0,program:void 0,uniforms:{},attributes:{}},particle:{vertexShader:void 0,fragmentShader:void 0,program:void 0,uniforms:{},attributes:{}}},this.setDefault()}var v=e.createProgram,x=o.isPowerOfTwo,g=(o.toPowerOfTwo,/attribute\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/),w=/uniform\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/;return t.extend(y,t),y.prototype.getExtensions=function(){var t=this.context,e=this.ext,i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),o=t.getExtension("OES_standard_derivatives"),r=t.getExtension("OES_texture_float");e.texture_filter_anisotropic=i,e.standard_derivatives=o,e.texture_float=r,e.compressed_texture_s3tc=n},y.prototype.getGPUCapabilities=function(){var t=this.context,e=this.gpu,n=this.ext,o=t.VERTEX_SHADER,r=t.FRAGMENT_SHADER,s=t.HIGH_FLOAT,a=t.MEDIUM_FLOAT,h=(t.LOW_FLOAT,t.getShaderPrecisionFormat!==void 0),u=n.texture_filter_anisotropic?t.getParameter(n.texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),p=t.getParameter(t.MAX_TEXTURE_SIZE),f=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),d=t.getParameter(t.MAX_RENDERBUFFER_SIZE),l=h?t.getShaderPrecisionFormat(o,s):0,m=h?t.getShaderPrecisionFormat(o,a):23,y=h?t.getShaderPrecisionFormat(r,s):0,v=h?t.getShaderPrecisionFormat(r,a):23,x=l.precision>0&&y.precision>0,g=m.precision>0&&v.precision>0,w="highp";(!x||i.mobile)&&(w=g?"mediump":"lowp"),e.precision=w,e.maxAnisotropy=u,e.maxTextures=c,e.maxTextureSize=p,e.maxCubeTextureSize=f,e.maxRenderBufferSize=d},y.prototype.setDefault=function(){var t=new Float32Array([1,1,-1,1,-1,-1,1,-1]),e=new Float32Array([1,0,0,0,0,1,1,1]),i=new Uint16Array([0,1,2,0,2,3]);return function(){var n,o=this.context,r=this.glData,s=this.gpu,a=r.particle,h=r.sprite;this.getExtensions(),this.getGPUCapabilities(),n=s.precision,o.clearColor(0,0,0,1),o.clearDepth(0),o.clearStencil(0),o.frontFace(o.CCW),o.cullFace(o.BACK),o.enable(o.CULL_FACE),o.enable(o.BLEND),o.blendEquationSeparate(o.FUNC_ADD,o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),a.vertexShader=f(n),a.fragmentShader=d(n),a.program=v(o,a.vertexShader,a.fragmentShader),c(o,a),h.vertexBuffer=h.vertexBuffer||o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,h.vertexBuffer),o.bufferData(o.ARRAY_BUFFER,t,o.STATIC_DRAW),h.uvBuffer=h.uvBuffer||o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,h.uvBuffer),o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW),h.indexBuffer=h.indexBuffer||o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,h.indexBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,i,o.STATIC_DRAW),h.vertexShader=l(n),h.fragmentShader=m(n),h.program=v(o,h.vertexShader,h.fragmentShader),c(o,h)}}(),y.prototype.setClearColor=function(t){t?this.context.clearColor(t.r,t.g,t.b,t.a):this.context.clearColor(0,0,0,1)},y.prototype.clear=function(){var t=this.context;t.clear(t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT)},y.prototype.setBlending=function(){var t,e;return function(i){if(e=this.context,i!==t){switch(i){case y.none:e.disable(e.BLEND);break;case y.additive:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE);break;case y.subtractive:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case y.multiply:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}t=i}}}(),y.prototype.setLineWidth=function(){var t=1;return function(e){e!==t&&(this.context.lineWidth(e*this.pixelRatio),t=e)}}(),y.prototype.render=function(){var t,e,i=new r;return function(n,o){var r=this,s=this.context,a=n.world.background;if(i.equals(a)||(this.setClearColor(a),i.copy(a)),t!==n&&(this.setClearColor(a),t=n),e!==o){var h=this.canvas,u=1/this.pixelRatio,c=h.width*u,p=h.height*u;o.width=c,o.height=p,o.clientWidth=window.innerWidth,o.clientHeight=window.innerHeight,s.viewport(0,0,h.width,h.height),h.fullScreen&&(h.off("resize"),h.on("resize",function(){var t=1/r.pixelRatio,e=this.width*t,i=this.height*t;o.width=e,o.height=i,o.clientWidth=window.innerWidth,o.clientHeight=window.innerHeight,s.viewport(0,0,this.width,this.height)})),e=o}this.autoClear&&this.clear(),this.renderComponents(n,o)}}(),y.prototype.renderComponents=function(){var t,e=[],i=new a,n=new h,o=new h,r=o.elements;return function(s,a){var h,c,f,d,l,m,y,v,x,g,w,b,z,A=this.context,_=this.glData,S=_.sprite,E=s.sprite2d||e;for(t instanceof u||(h=S.attributes,A.useProgram(S.program),A.bindBuffer(A.ARRAY_BUFFER,S.vertexBuffer),A.enableVertexAttribArray(h.aVertexPosition),A.vertexAttribPointer(h.aVertexPosition,2,A.FLOAT,!1,0,0),A.bindBuffer(A.ARRAY_BUFFER,S.uvBuffer),A.enableVertexAttribArray(h.aVertexUv),A.vertexAttribPointer(h.aVertexUv,2,A.FLOAT,!1,0,0),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,S.indexBuffer)),z=E.length;z--;)if(f=E[z],w=f.gameObject.transform2d,w&&f.visible){if(h=S.attributes,c=S.uniforms,d=f.image,b=f.alpha,!d)return console.warn(this+".renderSprite: can't render sprite without an ImageAsset"),void 0;p(this,d),l=d.glData.texture,m=d.data,y=f.width,v=f.height,x=1/m.width,g=1/m.height,i.mmul(w.matrixWorld,a.matrixWorldInv),n.fromMat32(i),o.mmul(a.matrixProj4,n),A.uniformMatrix4fv(c.uMatrix,!1,r),A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,l),A.uniform1i(c.uTexture,0),A.uniform4f(c.uCrop,f.x*x,f.y*g,f.w*x,f.h*g),A.uniform1f(c.uAlpha,b),A.uniform2f(c.uScale,y,v),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0),t=f}}}(),y.none=0,y.additive=1,y.subtractive=2,y.multiply=3,y}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/world/world",["base/class","math/color"],function(t,e){function i(i){i||(i={}),t.call(this),this.background=void 0!==i.color?i.color:new e(.5,.5,.5,1)}return t.extend(i,t),i.prototype.add=function(){},i.prototype.remove=function(){},i.prototype.update=function(){},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("input/buttons",["base/class","base/time"],function(t,e){function i(){this.timeDown=-1,this.timeUp=-1,this.frameDown=-1,this.frameUp=-1,this.value=!1,this._first=!0}function n(){this.list={mouse0:new i,mouse1:new i,mouse2:new i}}return n.prototype.on=function(t){this.list[t]||(this.list[t]=new i);var n=this.list[t];n&&(n._first&&(n.frameDown=e.frameCount+1,n.timeDown=e.stamp(),n._first=!1),n.value=!0)},n.prototype.off=function(t){var i=this.list[t];i&&(i.frameUp=e.frameCount+1,i.timeUp=e.stamp(),i._first=!0,i.value=!1)},new n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("input/axis",["base/class","base/dom","base/time","math/mathf","math/vec2","math/vec3","input/buttons"],function(t,e){function i(t){t||(t={}),this.name=void 0!==t.name?t.name:"unknown",this.negButton=void 0!==t.negButton?t.negButton:"",this.posButton=void 0!==t.posButton?t.posButton:"",this.altNegButton=void 0!==t.altNegButton?t.altNegButton:"",this.altPosButton=void 0!==t.altPosButton?t.altPosButton:"",this.gravity=void 0!==t.gravity?t.gravity:3,this.dead=void 0!==t.dead?t.dead:.001,this.sensitivity=void 0!==t.sensitivity?t.sensitivity:3,this.type=void 0!==t.type?t.type:i.BUTTON,this.axis=void 0!==t.axis?t.axis:"x",this.joyNum=void 0!==t.joyNum?t.joyNum:0,this.value=0
}return e.addEvent,e.removeEvent,i.BUTTON=1,i.MOUSE=2,i.MOUSE_WHEEL=3,i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("input/input",["base/class","base/dom","base/time","math/mathf","math/vec2","math/vec3","input/axis","input/buttons"],function(t,e,i,n,o,r,s,a){function h(){t.call(this),this.element=void 0,this.buttons=a,this.mousePosition=new o,this.mouseDelta=new o,this.axes={},this.addAxis({name:"horizontal",posButton:"right",negButton:"left",altPosButton:"d",altNegButton:"a",type:s.BUTTON}),this.addAxis({name:"vertical",posButton:"up",negButton:"down",altPosButton:"w",altNegButton:"s",type:s.BUTTON}),this.addAxis({name:"fire",posButton:"ctrl",negButton:"",altPosButton:"mouse0",altNegButton:"",type:s.BUTTON}),this.addAxis({name:"jump",posButton:"space",negButton:"",altPosButton:"mouse2",altNegButton:"",type:s.BUTTON}),this.addAxis({name:"mouseX",type:s.MOUSE,axis:"x"}),this.addAxis({name:"mouseY",type:s.MOUSE,axis:"y"}),this.addAxis({name:"mouseWheel",gravity:5,type:s.MOUSE_WHEEL})}function u(t){switch(t.preventDefault(),t.type){case"mousedown":a.on("mouse"+t.button);break;case"mouseup":a.off("mouse"+t.button);break;case"mouseout":a.off("mouse"+t.button);break;case"mousewheel":case"DOMMouseScroll":g=f(-1,p(1,t.wheelDelta||-t.detail));break;case"mousemove":if(w){var e=this.mousePosition,i=this.mouseDelta,n=t.target||t.srcElement,o=n.offsetLeft,r=n.offsetTop;x.x=e.x,x.y=e.y,e.x=(t.pageX||t.clientX)-o,e.y=(t.pageY||t.clientY)-r,i.x=e.x-x.x,i.y=e.y-x.y,w=!1}}}function c(t){switch(t.preventDefault(),t.type){case"keydown":a.on(b[t.keyCode]);break;case"keyup":a.off(b[t.keyCode])}}var p=Math.min,f=Math.max,d=Math.abs,l=n.sign,m=n.clamp,y=(n.equals,e.addEvent),v=e.removeEvent;t.extend(h,t),h.prototype.init=function(t){this.element=t,y(t,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",u,this),y(top,"keydown keyup",c,this)},h.prototype.clear=function(){var t=this.element;t&&(v(t,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",u,this),v(top,"keydown keyup",c,this)),this.element=void 0},h.prototype.update=function(){var t,e,n,o,r,h,u,c=this.axes,p=a.list,f=i.delta;w=!0;for(n in c){switch(o=c[n],r=o.value,o.type){case s.BUTTON:t=p[o.negButton],e=p[o.altNegButton],u=t&&t.value||e&&e.value,t=p[o.posButton],e=p[o.altPosButton],h=t&&t.value||e&&e.value;break;case s.MOUSE:o.value=this.mouseDelta[o.axis];continue;case s.MOUSE_WHEEL:r+=g}u&&(r-=o.sensitivity*f),h&&(r+=o.sensitivity*f),h||u||(r-=m(l(r)*o.gravity*f,-1,1)),r=m(r,-1,1),d(r)<=o.dead&&(r=0),o.value=r}g=0},h.prototype.addAxis=function(t){this.axes[t.name]=new s(t)},h.prototype.axis=function(t){var e=this.axes[t];return e&&e.value||0},h.prototype.mouseButton=function(t){var e=a.list["mouse"+t];return e&&e.value},h.prototype.mouseButtonDown=function(t){var e=a.list["mouse"+t];return e&&e.value&&e.frameDown>=i.frameCount},h.prototype.mouseButtonUp=function(t){var e=a.list["mouse"+t];return e&&e.frameUp>=i.frameCount},h.prototype.key=function(t){var e=a.list[t];return e&&e.value},h.prototype.keyDown=function(t){var e=a.list[t];return e&&e.value&&e.frameDown>=i.frameCount},h.prototype.keyUp=function(t){var e=a.list[t];return e&&e.frameUp>=i.frameCount};for(var x=new o,g=0,w=!1,b={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},z=48;90>=z;z++)b[z]=String.fromCharCode(z).toLowerCase();return new h}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/game/game",["base/class","base/dom","base/time","input/input","core/assets/assets","core/game/config","core/renderers/canvasrenderer2d","core/renderers/webglrenderer2d"],function(t,e,i,n,o,r,s,a){function h(e){e||(e={}),t.call(this),r.debug=void 0!==e.debug?!!e.debug:!1,r.forceCanvas=void 0!==e.forceCanvas?!!e.forceCanvas:!1,this.config=r,this.scene=void 0,this.camera=void 0,this.scenes=[],this.WebGLRenderer2D=new a(e),this.CanvasRenderer2D=new s(e),this.renderer=void 0,e.scenes&&this.addScenes.apply(this,e.scenes),e.scene&&this.setScene(e.scene),e.camera&&this.setCamera(e.camera)}var u=i.now,c=1e-6,p=1,f=e.requestAnimationFrame;return t.extend(h,t),h.prototype.init=function(){var t=this;o.load(function(){t.trigger("init"),t.animate()})},h.prototype.update=function(){var t=this.scene;t&&(i.sinceSceneStart=u()-i.sceneStart,t.update())},h.prototype.render=function(){var t=this.scene,e=this.camera;t&&e&&this.renderer.render(t,e)},h.prototype.animate=function(){var t,e=0,o=0,s=0,a=0,h=document.createElement("p"),d=0,l=0;return h.style.cssText=["z-index: 1000;","position: absolute;","margin: 0px;","padding: 0px;","color: #ddd;","text-shadow: 1px 1px #333;","-webkit-touch-callout: none;","-webkit-user-select: none;","-khtml-user-select: none;","-moz-user-select: moz-none;","-ms-user-select: none;","user-select: none;"].join("\n"),document.body.appendChild(h),function(){i.frameCount=e++,o=s,s=u(),r.debug&&(t=1e3*s,d++,t>l+1e3&&(h.innerHTML=(1e3*d/(t-l)).toFixed(3),l=t,d=0)),a=(s-o)*i.scale,i.delta=c>a?c:a>p?p:a,i.time=s*i.scale,i.sinceStart=s,n.update(),this.update(),this.render(),f(this.animate.bind(this))}}(),h.prototype.updateRenderer=function(t){this.CanvasRenderer2D.canvas.element.style.display="none",this.WebGLRenderer2D.canvas.element.style.display="none",t.camera2d&&(Device.webgl&&!r.forceCanvas?this.renderer=this.WebGLRenderer2D:Device.canvas?this.renderer=this.CanvasRenderer2D:console.warn(this+".updateRenderer: Could not get a renderer for this device")),n.clear(),n.init(this.renderer.canvas.element),this.renderer.canvas.element.style.display="block"},h.prototype.setScene=function(t){if(!t)return console.warn(this+".setScene: Scene is not defined"),void 0;var e=this.scenes,n=e.indexOf(t);0>n&&(console.warn(this+".setScene: Scene is not added to Game, adding it..."),this.addScene(t)),i.sceneStart=u(),t.init(),this.scene=t},h.prototype.setCamera=function(t){if(!this.scene)return console.warn(this+".setCamera: needs active scene for camera"),void 0;if(!t)return console.warn(this+".setCamera: Camera is not defined"),void 0;var e,i=this.scene,n=i.gameObjects,o=n.indexOf(t);0>o&&(console.warn(this+".setCamera: Camera is not added to Scene, adding it..."),i.addGameObject(t)),e=t.camera2d||t.camera3d,e?(this.camera=e,this.updateRenderer(t)):console.warn(this+".setCamera: GameObject does not have a Camera2D or Camera3D Component")},h.prototype.addScenes=function(){for(var t=arguments.length;t--;)this.addScene(arguments[t])},h.prototype.addScene=function(t){if(t){var e=this.scenes,i=e.indexOf(t);0>i?(t.game&&t.destroy(),t.game=this,e.push(t)):console.warn(this+".addScene: Scene is already added to Game")}},h.prototype.add=h.prototype.addScenes,h.prototype.removeScenes=function(){for(var t=arguments.length;t--;)this.removeScene(arguments[t])},h.prototype.removeScene=function(t){if(t){var e=this.scenes,i=e.indexOf(t);i>-1?(t.game=void 0,e.splice(i,1)):console.warn(this+".removeScene: Scene is not a member of Game")}},h.prototype.remove=h.prototype.removeScenes,h}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/gameobject",["base/class"],function(t){function e(e){e||(e={}),t.call(this),this.scene=void 0,this.tags=[],this.components={},this.camera2d=void 0,this.emitter2d=void 0,this.rigidbody2d=void 0,this.sprite2d=void 0,this.transform2d=void 0,e.components&&this.addComponents.apply(this,e.components),e.tags&&this.addTags.apply(this,e.tags)}return Object.defineProperty,t.extend(e,t),e.prototype.init=function(){var t,e,i=this.components;for(e in i)t=i[e],t.init(),t.trigger("init");this.trigger("init")},e.prototype.update=function(){var t,e,i=this.components;for(e in i)t=i[e],t.update(),t.trigger("update");this.trigger("update")},e.prototype.destroy=function(){var t=this.scene;t?t.removeGameObject(this):console.warn(this+".destroy: GameObject is not added to a Scene"),this.trigger("destroy")},e.prototype.addComponents=function(){for(var t=arguments.length;t--;)this.addComponent(arguments[t])},e.prototype.addComponent=function(t){if(!t)return console.warn(this+".addComponent: Component is not defined"),void 0;var e=this.components,i=""+t,n=e[i];n?console.warn(this+".addComponent: GameObject already has a "+t):(t.gameObject&&(t=t.clone()),t.gameObject=this,e[i]=t,this.scene&&(t.init(),t.trigger("init")),this[i.toLowerCase()]=t)},e.prototype.add=e.prototype.addComponents,e.prototype.removeComponents=function(){for(var t=arguments.length;t--;)this.removeComponent(arguments[t])},e.prototype.removeComponent=function(t){if(!t)return console.warn(this+".removeComponent: Component is not defined"),void 0;var e=this.components,i=""+t,n=e[i];n?(t.gameObject=void 0,e[i]=void 0,this[i.toLowerCase()]=void 0):console.warn(this+".removeComponent: GameObject does not have a "+t)},e.prototype.remove=e.prototype.removeComponents,e.prototype.getComponent=function(t){return this.components[t]},e.prototype.hasComponent=function(t){return!!this.components[t]},e.prototype.addTags=function(){for(var t=arguments.length;t--;)this.addTag(arguments[t])},e.prototype.addTag=function(t){if(!t)return console.warn(this+".addTag: tag is not defined"),void 0;var e=this.tags,i=e.indexOf(t);0>i&&e.push(t)},e.prototype.removeTags=function(){for(var t=arguments.length;t--;)this.removeTag(arguments[t])},e.prototype.removeTag=function(t){if(!t)return console.warn(this+".removeTag: tag is not defined"),void 0;var e=this.tags,i=e.indexOf(t);i>-1&&e.splice(i,1)},e.prototype.hasTag=function(t){return this.tags.indexOf(t)>-1},e}),"function"!=typeof define)var define=require("amdefine")(module);if(define("core/scene",["base/class","core/world/world"],function(t,e){function i(i){i||(i={}),t.call(this),this.game=void 0,this.gameObjects=[],this.components={},this.camera2d=void 0,this.emitter2d=void 0,this.rigidbody2d=void 0,this.sprite2d=void 0,this.transform2d=void 0,this.sortFunctions={Sprite2D:function(t,e){return e.z-t.z}},this.addFunctions={RigidBody:function(t){return this.world.add(t)}},this.removeFunctions={RigidBody:function(t){return this.world.remove(t)}},this.world=void 0!==i.world?i.world:new e(i),i.gameObjects&&this.addGameObjects.apply(this,i.gameObjects)}return t.extend(i,t),i.prototype.init=function(){var t,e=this.gameObjects;for(t=e.length;t--;)e[t].init();this.trigger("init")},i.prototype.update=function(){var t,e=this.gameObjects;for(this.world.update(),t=e.length;t--;)e[t].update();this.trigger("update")},i.prototype.destroy=function(){var t=this.game;t?t.removeScene(this):console.warn(this+".destroy: Scene is not added to Game"),this.trigger("destroy")},i.prototype.addGameObjects=function(){for(var t=arguments.length;t--;)this.addGameObject(arguments[t])},i.prototype.addGameObject=function(t){if(!t)return console.warn(this+".addGameObject: GameObject is not defined"),void 0;var e,i,n,o,r,s=this.gameObjects,a=s.indexOf(t),h=this.sortFunctions,u=this.addFunctions,c=this.components;if(0>a){t.scene&&t.destroy(),t.scene=this,s.push(t),this.game&&t.init(),i=t.components;for(r in i)n=i[r],o=r.toLowerCase(),e=c[r]=c[r]||[],e.push(n),h[r]||(h[r]=this.sort),e.sort(h[r]),this[o]||(this[o]=e),u[r]&&u[r].call(this,n)}else console.warn(this+".addGameObject: GameObject is already added to Scene")},i.prototype.add=i.prototype.addGameObjects,i.prototype.removeGameObjects=function(){for(var t=arguments.length;t--;)this.removeGameObject(arguments[t])},i.prototype.removeGameObject=function(t){if(!t)return console.warn(this+".removeGameObject: GameObject is not defined"),void 0;var e,i,n,o,r=this.gameObjects,s=r.indexOf(t),a=this.sortFunctions,h=this.removeFunctions,u=this.components;if(s>-1){t.scene=void 0,r.splice(s,1),i=t.components;for(o in i)n=i[o],e=u[o]=u[o]||[],e.splice(e.indexOf(n),1),e.sort(a[o]),h[o]&&h[o].call(this,n)}else console.warn(this+".removeGameObject: GameObject is not a member of Scene")},i.prototype.remove=i.prototype.removeGameObjects,i.prototype.sort=function(t,e){return t===e?1:-1},i.prototype.findByTag=function(){var t=[];return function(e,i){t.length=0,i||(i=t);var n,o,r=this.gameObjects;for(o=r.length;o--;)n=r[o],n.hasTag(e)&&i.push(n);return i}}(),i.prototype.findById=function(t){var e,i,n=this.gameObjects;for(i=n.length;i--;)if(e=n[i],e._id===t)return e;return void 0},i}),"function"!=typeof define)var define=require("amdefine")(module);define("odin",["require","base/class","base/device","base/dom","base/objectpool","base/time","base/utils","math/aabb2","math/aabb3","math/color","math/line2","math/mat2","math/mat3","math/mat32","math/mat4","math/mathf","math/quat","math/vec2","math/vec3","math/vec4","core/assets/asset","core/assets/assets","core/assets/imageasset","core/assets/spritesheetasset","core/components/camera2d","core/components/component","core/components/emitter2d","core/components/rigidbody2d","core/components/sprite2d","core/components/transform2d","core/renderers/canvasrenderer2d","core/renderers/webglrenderer2d","core/world/world","core/game/game","core/game/config","core/canvas","core/gameobject","core/scene","input/input"],function(t){var e={};return e.globalize=function(){for(var t in this)window[t]=this[t];window.Odin=this},e.test=function(){var t,e,i=Date.now;return function(n,o,r){for(t=i(),e=0;o>e;e++)r();console.log(n+": "+(i()-t)+"ms")}}(),e.Class=t("base/class"),e.Device=t("base/device"),e.Dom=t("base/dom"),e.ObjectPool=t("base/objectpool"),e.Time=t("base/time"),e.Utils=t("base/utils"),e.AABB2=t("math/aabb2"),e.AABB3=t("math/aabb3"),e.Color=t("math/color"),e.Line2=t("math/line2"),e.Mat2=t("math/mat2"),e.Mat3=t("math/mat3"),e.Mat32=t("math/mat32"),e.Mat4=t("math/mat4"),e.Mathf=t("math/mathf"),e.Quat=t("math/quat"),e.Vec2=t("math/vec2"),e.Vec3=t("math/vec3"),e.Vec4=t("math/vec4"),e.Asset=t("core/assets/asset"),e.Assets=t("core/assets/assets"),e.ImageAsset=t("core/assets/imageasset"),e.SpriteSheetAsset=t("core/assets/spritesheetasset"),e.Camera2D=t("core/components/camera2d"),e.Component=t("core/components/component"),e.Emitter2D=t("core/components/emitter2d"),e.RigidBody2D=t("core/components/rigidbody2d"),e.Sprite2D=t("core/components/sprite2d"),e.Transform2D=t("core/components/transform2d"),e.CanvasRenderer2D=t("core/renderers/canvasrenderer2d"),e.WebGLRenderer2D=t("core/renderers/webglrenderer2d"),e.World=t("core/world/world"),e.Game=t("core/game/game"),e.Config=t("core/game/config"),e.Canvas=t("core/canvas"),e.GameObject=t("core/gameobject"),e.Scene=t("core/scene"),e.Input=t("input/input"),e});